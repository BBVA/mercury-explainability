
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../..">
      
      
        <link rel="next" href="../explanations/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.2">
    
    
      
        <title>explainers - mercury-explainability</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.d7758b05.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#base-tests" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="mercury-explainability" class="md-header__button md-logo" aria-label="mercury-explainability" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            mercury-explainability
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              explainers
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/BBVA/mercury-explainability/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    mercury-explainability
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="mercury-explainability" class="md-nav__button md-logo" aria-label="mercury-explainability" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg>

    </a>
    mercury-explainability
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/BBVA/mercury-explainability/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    mercury-explainability
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Api
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Api
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    explainers
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    explainers
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mercury.explainability.explainers" class="md-nav__link">
    <span class="md-ellipsis">
      explainers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="explainers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.run_until_timeout" class="md-nav__link">
    <span class="md-ellipsis">
      run_until_timeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers._dummy_alibi_explainers" class="md-nav__link">
    <span class="md-ellipsis">
      _dummy_alibi_explainers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="_dummy_alibi_explainers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers._dummy_alibi_explainers._DummyAlibiExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      _DummyAlibiExplainer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale" class="md-nav__link">
    <span class="md-ellipsis">
      ale
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ale">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale.ALEExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      ALEExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ALEExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale.ALEExplainer._build_explanation" class="md-nav__link">
    <span class="md-ellipsis">
      _build_explanation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale.ALEExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale.ALEExplainer.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale._plot_one_ale_num" class="md-nav__link">
    <span class="md-ellipsis">
      _plot_one_ale_num
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale.plot_ale" class="md-nav__link">
    <span class="md-ellipsis">
      plot_ale
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.anchors" class="md-nav__link">
    <span class="md-ellipsis">
      anchors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="anchors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      AnchorsWithImportanceExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AnchorsWithImportanceExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer.get_feature_importance" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_importance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer.translate" class="md-nav__link">
    <span class="md-ellipsis">
      translate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies" class="md-nav__link">
    <span class="md-ellipsis">
      cf_strategies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cf_strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.Backtracking" class="md-nav__link">
    <span class="md-ellipsis">
      Backtracking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backtracking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.Backtracking.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.SimulatedAnnealing" class="md-nav__link">
    <span class="md-ellipsis">
      SimulatedAnnealing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SimulatedAnnealing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.SimulatedAnnealing.best_solution" class="md-nav__link">
    <span class="md-ellipsis">
      best_solution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.SimulatedAnnealing.energy" class="md-nav__link">
    <span class="md-ellipsis">
      energy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.SimulatedAnnealing.move" class="md-nav__link">
    <span class="md-ellipsis">
      move
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.SimulatedAnnealing.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.Strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer" class="md-nav__link">
    <span class="md-ellipsis">
      clustering_tree_explainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="clustering_tree_explainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.ClusteringTreeExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      ClusteringTreeExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ClusteringTreeExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.ClusteringTreeExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.ClusteringTreeExplainer.score" class="md-nav__link">
    <span class="md-ellipsis">
      score
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.ClusteringTreeExplainer.surrogate_score" class="md-nav__link">
    <span class="md-ellipsis">
      surrogate_score
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree" class="md-nav__link">
    <span class="md-ellipsis">
      Tree
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tree">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree.__max_depth__" class="md-nav__link">
    <span class="md-ellipsis">
      __max_depth__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree.__size__" class="md-nav__link">
    <span class="md-ellipsis">
      __size__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree._build_tree" class="md-nav__link">
    <span class="md-ellipsis">
      _build_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree._max_depth" class="md-nav__link">
    <span class="md-ellipsis">
      _max_depth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree._size" class="md-nav__link">
    <span class="md-ellipsis">
      _size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_basic" class="md-nav__link">
    <span class="md-ellipsis">
      counter_fact_basic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="counter_fact_basic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_basic.CounterFactualExplainerBasic" class="md-nav__link">
    <span class="md-ellipsis">
      CounterFactualExplainerBasic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CounterFactualExplainerBasic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_basic.CounterFactualExplainerBasic.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance" class="md-nav__link">
    <span class="md-ellipsis">
      counter_fact_importance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="counter_fact_importance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase" class="md-nav__link">
    <span class="md-ellipsis">
      CounterFactualExplainerBase
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CounterFactualExplainerBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase._compute_feature_range" class="md-nav__link">
    <span class="md-ellipsis">
      _compute_feature_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase._regularize_counterfactual" class="md-nav__link">
    <span class="md-ellipsis">
      _regularize_counterfactual
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase.get_feature_importance" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_importance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterfactualExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      CounterfactualExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CounterfactualExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterfactualExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterfactualProtoExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      CounterfactualProtoExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CounterfactualProtoExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterfactualProtoExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.explainer" class="md-nav__link">
    <span class="md-ellipsis">
      explainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="explainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.explainer.MercuryExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      MercuryExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MercuryExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.explainer.MercuryExplainer.load" class="md-nav__link">
    <span class="md-ellipsis">
      load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.explainer.MercuryExplainer.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence" class="md-nav__link">
    <span class="md-ellipsis">
      partial_dependence
    </span>
  </a>
  
    <nav class="md-nav" aria-label="partial_dependence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      PartialDependenceExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PartialDependenceExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.__base_impl" class="md-nav__link">
    <span class="md-ellipsis">
      __base_impl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.__partial_dep_base" class="md-nav__link">
    <span class="md-ellipsis">
      __partial_dep_base
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.__partial_dep_pyspark" class="md-nav__link">
    <span class="md-ellipsis">
      __partial_dep_pyspark
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.__pyspark_impl" class="md-nav__link">
    <span class="md-ellipsis">
      __pyspark_impl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.shuffle_importance" class="md-nav__link">
    <span class="md-ellipsis">
      shuffle_importance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="shuffle_importance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.shuffle_importance.ShuffleImportanceExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      ShuffleImportanceExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ShuffleImportanceExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.shuffle_importance.ShuffleImportanceExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../explanations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    explanations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mercury.explainability.explainers" class="md-nav__link">
    <span class="md-ellipsis">
      explainers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="explainers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.run_until_timeout" class="md-nav__link">
    <span class="md-ellipsis">
      run_until_timeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers._dummy_alibi_explainers" class="md-nav__link">
    <span class="md-ellipsis">
      _dummy_alibi_explainers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="_dummy_alibi_explainers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers._dummy_alibi_explainers._DummyAlibiExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      _DummyAlibiExplainer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale" class="md-nav__link">
    <span class="md-ellipsis">
      ale
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ale">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale.ALEExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      ALEExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ALEExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale.ALEExplainer._build_explanation" class="md-nav__link">
    <span class="md-ellipsis">
      _build_explanation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale.ALEExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale.ALEExplainer.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale._plot_one_ale_num" class="md-nav__link">
    <span class="md-ellipsis">
      _plot_one_ale_num
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.ale.plot_ale" class="md-nav__link">
    <span class="md-ellipsis">
      plot_ale
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.anchors" class="md-nav__link">
    <span class="md-ellipsis">
      anchors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="anchors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      AnchorsWithImportanceExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AnchorsWithImportanceExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer.get_feature_importance" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_importance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer.translate" class="md-nav__link">
    <span class="md-ellipsis">
      translate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies" class="md-nav__link">
    <span class="md-ellipsis">
      cf_strategies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cf_strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.Backtracking" class="md-nav__link">
    <span class="md-ellipsis">
      Backtracking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backtracking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.Backtracking.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.SimulatedAnnealing" class="md-nav__link">
    <span class="md-ellipsis">
      SimulatedAnnealing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SimulatedAnnealing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.SimulatedAnnealing.best_solution" class="md-nav__link">
    <span class="md-ellipsis">
      best_solution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.SimulatedAnnealing.energy" class="md-nav__link">
    <span class="md-ellipsis">
      energy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.SimulatedAnnealing.move" class="md-nav__link">
    <span class="md-ellipsis">
      move
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.SimulatedAnnealing.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.cf_strategies.Strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer" class="md-nav__link">
    <span class="md-ellipsis">
      clustering_tree_explainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="clustering_tree_explainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.ClusteringTreeExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      ClusteringTreeExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ClusteringTreeExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.ClusteringTreeExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.ClusteringTreeExplainer.score" class="md-nav__link">
    <span class="md-ellipsis">
      score
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.ClusteringTreeExplainer.surrogate_score" class="md-nav__link">
    <span class="md-ellipsis">
      surrogate_score
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree" class="md-nav__link">
    <span class="md-ellipsis">
      Tree
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tree">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree.__max_depth__" class="md-nav__link">
    <span class="md-ellipsis">
      __max_depth__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree.__size__" class="md-nav__link">
    <span class="md-ellipsis">
      __size__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree._build_tree" class="md-nav__link">
    <span class="md-ellipsis">
      _build_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree._max_depth" class="md-nav__link">
    <span class="md-ellipsis">
      _max_depth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree._size" class="md-nav__link">
    <span class="md-ellipsis">
      _size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.clustering_tree_explainer.Tree.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_basic" class="md-nav__link">
    <span class="md-ellipsis">
      counter_fact_basic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="counter_fact_basic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_basic.CounterFactualExplainerBasic" class="md-nav__link">
    <span class="md-ellipsis">
      CounterFactualExplainerBasic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CounterFactualExplainerBasic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_basic.CounterFactualExplainerBasic.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance" class="md-nav__link">
    <span class="md-ellipsis">
      counter_fact_importance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="counter_fact_importance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase" class="md-nav__link">
    <span class="md-ellipsis">
      CounterFactualExplainerBase
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CounterFactualExplainerBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase._compute_feature_range" class="md-nav__link">
    <span class="md-ellipsis">
      _compute_feature_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase._regularize_counterfactual" class="md-nav__link">
    <span class="md-ellipsis">
      _regularize_counterfactual
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase.get_feature_importance" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_importance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterfactualExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      CounterfactualExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CounterfactualExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterfactualExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterfactualProtoExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      CounterfactualProtoExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CounterfactualProtoExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.counter_fact_importance.CounterfactualProtoExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.explainer" class="md-nav__link">
    <span class="md-ellipsis">
      explainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="explainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.explainer.MercuryExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      MercuryExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MercuryExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.explainer.MercuryExplainer.load" class="md-nav__link">
    <span class="md-ellipsis">
      load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.explainer.MercuryExplainer.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence" class="md-nav__link">
    <span class="md-ellipsis">
      partial_dependence
    </span>
  </a>
  
    <nav class="md-nav" aria-label="partial_dependence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      PartialDependenceExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PartialDependenceExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.__base_impl" class="md-nav__link">
    <span class="md-ellipsis">
      __base_impl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.__partial_dep_base" class="md-nav__link">
    <span class="md-ellipsis">
      __partial_dep_base
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.__partial_dep_pyspark" class="md-nav__link">
    <span class="md-ellipsis">
      __partial_dep_pyspark
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.__pyspark_impl" class="md-nav__link">
    <span class="md-ellipsis">
      __pyspark_impl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.shuffle_importance" class="md-nav__link">
    <span class="md-ellipsis">
      shuffle_importance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="shuffle_importance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.shuffle_importance.ShuffleImportanceExplainer" class="md-nav__link">
    <span class="md-ellipsis">
      ShuffleImportanceExplainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ShuffleImportanceExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.explainability.explainers.shuffle_importance.ShuffleImportanceExplainer.explain" class="md-nav__link">
    <span class="md-ellipsis">
      explain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="base-tests">Base Tests</h1>


<div class="doc doc-object doc-module">



<h2 id="mercury.explainability.explainers" class="doc doc-heading">
            <code>mercury.explainability.explainers</code>


</h2>

    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="mercury.explainability.explainers.run_until_timeout" class="doc doc-heading">
            <code class=" language-python"><span class="n">run_until_timeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Timeout function to stop the execution in case it takes longer than the timeout argument.
After timeout seconds it will raise an exception.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of seconds until the Exception is raised.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fn</code>
            </td>
            <td>
                  <code>callable</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to execute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>args of the function fn.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword args passed to fn.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>explanation = run_until_timeout(timeout, explainer.explain, data=data)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/__init__.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_until_timeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Timeout function to stop the execution in case it takes longer than the timeout argument.</span>
<span class="sd">    After timeout seconds it will raise an exception.</span>

<span class="sd">    Args:</span>
<span class="sd">        timeout (int): Number of seconds until the Exception is raised.</span>
<span class="sd">        fn (callable): Function to execute.</span>
<span class="sd">        *args (dict): args of the function fn.</span>
<span class="sd">        **kwargs (dict): keyword args passed to fn.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; explanation = run_until_timeout(timeout, explainer.explain, data=data)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">signal_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Timeout: explanation took too long...&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">timeout</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>


<div class="doc doc-object doc-module">



<h3 id="mercury.explainability.explainers._dummy_alibi_explainers" class="doc doc-heading">
            <code>_dummy_alibi_explainers</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers._dummy_alibi_explainers._DummyAlibiExplainer" class="doc doc-heading">
              <code class=" language-python"><span class="n">_DummyAlibiExplainer</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">


        <p>Class which raises and error if instantiated</p>






                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/_dummy_alibi_explainers.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">ModuleNotFoundError</span><span class="p">(</span><span class="s2">&quot;You need to install alibi library to use this explainer.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.explainability.explainers.ale" class="doc doc-heading">
            <code>ale</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.ale.ALEExplainer" class="doc doc-heading">
              <code class=" language-python"><span class="n">ALEExplainer</span><span class="p">(</span><span class="n">predictor</span><span class="p">,</span> <span class="n">target_names</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="alibi.api.interfaces.Explainer">Explainer</span></code>, <code><a class="autorefs autorefs-internal" title="mercury.explainability.explainers.explainer.MercuryExplainer" href="#mercury.explainability.explainers.explainer.MercuryExplainer">MercuryExplainer</a></code></p>


        <p>Accumulated Local Effects for tabular datasets. Current implementation supports first order
feature effects of numerical features.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>predictor</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A callable that takes in an NxF array as input and outputs an NxT array (N - number of
data points, F - number of features, T - number of outputs/targets (e.g. 1 for single output
regression, &gt;=2 for classification).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_names</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[str], str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of target/output names used for displaying results.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>






                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/ale.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictor</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">target_names</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">meta</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">DEFAULT_META_ALE</span><span class="p">))</span>

    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;The attribute target_names should be a string or list.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">target_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">target_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">target_names</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span> <span class="o">=</span> <span class="n">predictor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_names</span> <span class="o">=</span> <span class="n">target_names</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.ale.ALEExplainer._build_explanation" class="doc doc-heading">
            <code class=" language-python"><span class="n">_build_explanation</span><span class="p">(</span><span class="n">ale_values</span><span class="p">,</span> <span class="n">ale0</span><span class="p">,</span> <span class="n">constant_value</span><span class="p">,</span> <span class="n">feature_values</span><span class="p">,</span> <span class="n">feature_deciles</span><span class="p">,</span> <span class="n">ignore_features</span><span class="o">=</span><span class="p">[])</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Helper method to build the Explanation object.</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/ale.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_build_explanation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">ale_values</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
                      <span class="n">ale0</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
                      <span class="n">constant_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                      <span class="n">feature_values</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
                      <span class="n">feature_deciles</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
                      <span class="n">ignore_features</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="n">Explanation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper method to build the Explanation object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO decide on the format for these lists of arrays</span>
    <span class="c1"># Currently each list element relates to a feature and each column relates to an output dimension,</span>
    <span class="c1"># this is different from e.g. SHAP but arguably more convenient for ALE.</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">DEFAULT_DATA_ALE</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">ale_values</span><span class="o">=</span><span class="n">ale_values</span><span class="p">,</span>
        <span class="n">ale0</span><span class="o">=</span><span class="n">ale0</span><span class="p">,</span>
        <span class="n">constant_value</span><span class="o">=</span><span class="n">constant_value</span><span class="p">,</span>
        <span class="n">feature_values</span><span class="o">=</span><span class="n">feature_values</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="o">=</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_features</span><span class="p">],</span>
        <span class="n">target_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_names</span><span class="p">,</span>
        <span class="n">feature_deciles</span><span class="o">=</span><span class="n">feature_deciles</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">Explanation</span><span class="p">(</span><span class="n">meta</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.ale.ALEExplainer.explain" class="doc doc-heading">
            <code class=" language-python"><span class="n">explain</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">min_bin_points</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ignore_features</span><span class="o">=</span><span class="p">[])</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Calculate the ALE curves for each feature with respect to the dataset <code>X</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>X</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An NxF tabular dataset used to calculate the ALE curves. This is typically the training dataset
or a representative sample.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_bin_points</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of points each discretized interval should contain to ensure more precise
ALE estimation.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ignore_features</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Features that will be ignored while computing the ALE curves. Useful for reducing computing time
if there are predictors we dont care about.</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="alibi.api.interfaces.Explanation">Explanation</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An <code>Explanation</code> object containing the data and the metadata of the calculated ALE curves.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/ale.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">min_bin_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ignore_features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="n">Explanation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the ALE curves for each feature with respect to the dataset `X`.</span>

<span class="sd">    Args:</span>
<span class="sd">        X:</span>
<span class="sd">            An NxF tabular dataset used to calculate the ALE curves. This is typically the training dataset</span>
<span class="sd">            or a representative sample.</span>
<span class="sd">        min_bin_points:</span>
<span class="sd">            Minimum number of points each discretized interval should contain to ensure more precise</span>
<span class="sd">            ALE estimation.</span>
<span class="sd">        ignore_features:</span>
<span class="sd">            Features that will be ignored while computing the ALE curves. Useful for reducing computing time</span>
<span class="sd">            if there are predictors we dont care about.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An `Explanation` object containing the data and the metadata of the calculated ALE curves.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">min_bin_points</span><span class="o">=</span><span class="n">min_bin_points</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;X must be a pandas DataFrame&#39;</span><span class="p">)</span>

    <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">n_features</span> <span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_names</span><span class="p">)</span>

    <span class="n">feature_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ale_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ale0</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">feature_deciles</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># TODO: use joblib to paralelise?</span>
    <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">feat_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_features</span><span class="p">:</span>
            <span class="n">q</span><span class="p">,</span> <span class="n">ale</span><span class="p">,</span> <span class="n">a0</span> <span class="o">=</span> <span class="n">ale_num</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span><span class="p">,</span>
                <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>
                <span class="n">feature</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span>
                <span class="n">min_bin_points</span><span class="o">=</span><span class="n">min_bin_points</span>
            <span class="p">)</span>
            <span class="n">deciles</span> <span class="o">=</span> <span class="n">get_quantiles</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">],</span> <span class="n">num_quantiles</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

            <span class="n">feature_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="n">ale_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ale</span><span class="p">)</span>
            <span class="n">ale0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a0</span><span class="p">)</span>
            <span class="n">feature_deciles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deciles</span><span class="p">)</span>

    <span class="n">constant_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="c1"># TODO: an ALE plot ideally requires a rugplot to gauge density of instances in the feature space.</span>
    <span class="c1"># I&#39;ve replaced this with feature deciles which is coarser but has constant space complexity</span>
    <span class="c1"># as opposed to a rugplot. Alternatively, could consider subsampling to produce a rug with some</span>
    <span class="c1"># maximum number of points.</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_explanation</span><span class="p">(</span>
        <span class="n">ale_values</span><span class="o">=</span><span class="n">ale_values</span><span class="p">,</span>
        <span class="n">ale0</span><span class="o">=</span><span class="n">ale0</span><span class="p">,</span>
        <span class="n">constant_value</span><span class="o">=</span><span class="n">constant_value</span><span class="p">,</span>
        <span class="n">feature_values</span><span class="o">=</span><span class="n">feature_values</span><span class="p">,</span>
        <span class="n">feature_deciles</span><span class="o">=</span><span class="n">feature_deciles</span><span class="p">,</span>
        <span class="n">ignore_features</span><span class="o">=</span><span class="n">ignore_features</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.ale.ALEExplainer.save" class="doc doc-heading">
            <code class=" language-python"><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Overwrite to ensure that we use MercuryExplainer.save</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/ale.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Overwrite to ensure that we use MercuryExplainer.save&quot;&quot;&quot;</span>
    <span class="n">MercuryExplainer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="mercury.explainability.explainers.ale._plot_one_ale_num" class="doc doc-heading">
            <code class=" language-python"><span class="n">_plot_one_ale_num</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">line_kw</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Plots the ALE of exactly one feature on one axes.</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/ale.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@no_type_check</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_plot_one_ale_num</span><span class="p">(</span><span class="n">exp</span><span class="p">:</span> <span class="n">Explanation</span><span class="p">,</span>
                      <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                      <span class="n">targets</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                      <span class="n">constant</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">ax</span><span class="p">:</span> <span class="s1">&#39;plt.Axes&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">line_kw</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;plt.Axes&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the ALE of exactly one feature on one axes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">transforms</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="c1"># add zero baseline</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>

    <span class="c1"># Sometimes within the computation of the ale values, we get more values corresponding</span>
    <span class="c1"># to the feature than values corresponding to the target or vice-versa, i.e. the number</span>
    <span class="c1"># of X&#39;s and Y&#39;s is not the same and therefore is not possible to properly build the ale</span>
    <span class="c1"># plot. These conditions help ensure len(x) equals len(y).</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">feature_values</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">ale_values</span><span class="p">[</span><span class="n">feature</span><span class="p">][:,</span> <span class="n">targets</span><span class="p">]):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">exp</span><span class="o">.</span><span class="n">feature_values</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span>
            <span class="n">exp</span><span class="o">.</span><span class="n">ale_values</span><span class="p">[</span><span class="n">feature</span><span class="p">][:,</span> <span class="n">targets</span><span class="p">]</span> <span class="o">+</span> <span class="n">constant</span> <span class="o">*</span> <span class="n">exp</span><span class="o">.</span><span class="n">constant_value</span><span class="p">,</span>
            <span class="o">**</span><span class="n">line_kw</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">feature_values</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">ale_values</span><span class="p">[</span><span class="n">feature</span><span class="p">][:,</span> <span class="n">targets</span><span class="p">]):</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">ale_values</span><span class="p">[</span><span class="n">feature</span><span class="p">][:,</span> <span class="n">targets</span><span class="p">])</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">feature_values</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">feature_values</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">feature_values</span><span class="p">[</span><span class="n">feature</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">diff</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">ale_values</span><span class="p">[</span><span class="n">feature</span><span class="p">][:,</span> <span class="n">targets</span><span class="p">]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">line_kw</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">feature_values</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">ale_values</span><span class="p">[</span><span class="n">feature</span><span class="p">][:,</span> <span class="n">targets</span><span class="p">]):</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">feature_values</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">ale_values</span><span class="p">[</span><span class="n">feature</span><span class="p">][:,</span> <span class="n">targets</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">ale_values</span><span class="p">[</span><span class="n">feature</span><span class="p">][:,</span> <span class="n">targets</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">ale_values</span><span class="p">[</span><span class="n">feature</span><span class="p">][:,</span> <span class="n">targets</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">diff</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">feature_values</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">line_kw</span>
        <span class="p">)</span>

    <span class="c1"># add decile markers to the bottom of the plot</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">blended_transform_factory</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">feature_deciles</span><span class="p">[</span><span class="n">feature</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">feature_names</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;ALE&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="c1"># if no explicit labels passed, just use target names</span>
        <span class="k">if</span> <span class="n">line_kw</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">exp</span><span class="o">.</span><span class="n">target_names</span><span class="p">[</span><span class="n">targets</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mercury.explainability.explainers.ale.plot_ale" class="doc doc-heading">
            <code class=" language-python"><span class="n">plot_ale</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig_kw</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Plot ALE curves on matplotlib axes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>exp</code>
            </td>
            <td>
                  <code><span title="alibi.api.interfaces.Explanation">Explanation</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An <code>Explanation</code> object produced by a call to the <code>ALE.explain</code> method.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[<span title="typing.Union">Union</span>[int, str]], str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of features for which to plot the ALE curves or <code>all</code> for all features.
Can be a mix of integers denoting feature index or strings denoting entries in
<code>exp.feature_names</code>. Defaults to 'all'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;all&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>targets</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[<span title="typing.Union">Union</span>[int, str]], str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of targets for which to plot the ALE curves or <code>all</code> for all targets.
Can be a mix of integers denoting target index or strings denoting entries in
<code>exp.target_names</code>. Defaults to 'all'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;all&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_cols</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of columns to organize the resulting plot into.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sharey</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A parameter specifying whether the y-axis of the ALE curves should be on the same scale
for several features. Possible values are <code>all</code>, <code>row</code>, <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;all&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>constant</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A parameter specifying whether the constant zeroth order effects should be added to the
ALE first order effects.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ax</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="matplotlib.pyplot.Axes">Axes</span>, <span title="numpy.ndarray">ndarray</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A <code>matplotlib</code> axes object or a numpy array of <code>matplotlib</code> axes to plot on.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>line_kw</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments passed to the <code>plt.plot</code> function.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fig_kw</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments passed to the <code>fig.set</code> function.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An array of matplotlib axes with the resulting ALE plots.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/ale.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@no_type_check</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_ale</span><span class="p">(</span><span class="n">exp</span><span class="p">:</span> <span class="n">Explanation</span><span class="p">,</span>
             <span class="n">features</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
             <span class="n">targets</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
             <span class="n">n_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
             <span class="n">sharey</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
             <span class="n">constant</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">ax</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s1">&#39;plt.Axes&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">line_kw</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">fig_kw</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot ALE curves on matplotlib axes.</span>

<span class="sd">    Args:</span>
<span class="sd">        exp: An `Explanation` object produced by a call to the `ALE.explain` method.</span>
<span class="sd">        features: A list of features for which to plot the ALE curves or `all` for all features.</span>
<span class="sd">            Can be a mix of integers denoting feature index or strings denoting entries in</span>
<span class="sd">            `exp.feature_names`. Defaults to &#39;all&#39;.</span>
<span class="sd">        targets: A list of targets for which to plot the ALE curves or `all` for all targets.</span>
<span class="sd">            Can be a mix of integers denoting target index or strings denoting entries in</span>
<span class="sd">            `exp.target_names`. Defaults to &#39;all&#39;.</span>
<span class="sd">        n_cols: Number of columns to organize the resulting plot into.</span>
<span class="sd">        sharey: A parameter specifying whether the y-axis of the ALE curves should be on the same scale</span>
<span class="sd">            for several features. Possible values are `all`, `row`, `None`.</span>
<span class="sd">        constant: A parameter specifying whether the constant zeroth order effects should be added to the</span>
<span class="sd">            ALE first order effects.</span>
<span class="sd">        ax: A `matplotlib` axes object or a numpy array of `matplotlib` axes to plot on.</span>
<span class="sd">        line_kw: Keyword arguments passed to the `plt.plot` function.</span>
<span class="sd">        fig_kw: Keyword arguments passed to the `fig.set` function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An array of matplotlib axes with the resulting ALE plots.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># line_kw and fig_kw values</span>
    <span class="n">default_line_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">line_kw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">line_kw</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">line_kw</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">default_line_kw</span><span class="p">,</span> <span class="o">**</span><span class="n">line_kw</span><span class="p">}</span>

    <span class="n">default_fig_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tight_layout&#39;</span><span class="p">:</span> <span class="s1">&#39;tight&#39;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">fig_kw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig_kw</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">fig_kw</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">default_fig_kw</span><span class="p">,</span> <span class="o">**</span><span class="n">fig_kw</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">features</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="n">selected_features</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">feature_names</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">selected_features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">selected_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">feature_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Feature name </span><span class="si">{}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">selected_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">n_features</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_features</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">targets</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">target_names</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">targets</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">target_names</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Target name </span><span class="si">{}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="n">targets</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>

    <span class="c1"># make axes</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">n_features</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>  <span class="c1"># treat passed axis as a canvas for subplots</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>
        <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n_cols</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span>
        <span class="n">n_rows</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_features</span> <span class="o">/</span> <span class="n">n_cols</span><span class="p">)</span>

        <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">)</span>
        <span class="n">axes_ravel</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="c1"># gs = GridSpecFromSubplotSpec(n_rows, n_cols, subplot_spec=ax.get_subplotspec())</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_features</span><span class="p">),</span> <span class="n">gs</span><span class="p">):</span>
            <span class="c1"># determine which y-axes should be shared</span>
            <span class="k">if</span> <span class="n">sharey</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">cond</span> <span class="o">=</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">sharey</span> <span class="o">==</span> <span class="s1">&#39;row&#39;</span><span class="p">:</span>
                <span class="n">cond</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">n_cols</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cond</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">cond</span><span class="p">:</span>
                <span class="n">axes_ravel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">axes_ravel</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">continue</span>
            <span class="n">axes_ravel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># array-like</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">n_features</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected ax to have </span><span class="si">{}</span><span class="s2"> axes, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_features</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">axes_ravel</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">axes_ravel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

    <span class="c1"># make plots</span>
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">ax_ravel</span> <span class="ow">in</span> \
            <span class="nb">zip</span><span class="p">(</span><span class="n">count</span><span class="p">(),</span> <span class="n">selected_features</span><span class="p">,</span> <span class="n">axes_ravel</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">_plot_one_ale_num</span><span class="p">(</span><span class="n">exp</span><span class="o">=</span><span class="n">exp</span><span class="p">,</span>
                              <span class="n">feature</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span>
                              <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
                              <span class="n">constant</span><span class="o">=</span><span class="n">constant</span><span class="p">,</span>
                              <span class="n">ax</span><span class="o">=</span><span class="n">ax_ravel</span><span class="p">,</span>
                              <span class="n">legend</span><span class="o">=</span><span class="ow">not</span> <span class="n">ix</span><span class="p">,</span>  <span class="c1"># only one legend</span>
                              <span class="n">line_kw</span><span class="o">=</span><span class="n">line_kw</span><span class="p">)</span>

    <span class="c1"># if explicit labels passed, handle the legend here as the axis passed might be repeated</span>
    <span class="k">if</span> <span class="n">line_kw</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">axes_ravel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">fig_kw</span><span class="p">)</span>
    <span class="c1"># TODO: should we return just axes or ax + axes</span>
    <span class="k">return</span> <span class="n">axes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.explainability.explainers.anchors" class="doc doc-heading">
            <code>anchors</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer" class="doc doc-heading">
              <code class=" language-python"><span class="n">AnchorsWithImportanceExplainer</span><span class="p">(</span><span class="n">predict_fn</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">categorical_names</span><span class="o">=</span><span class="p">{},</span> <span class="n">disc_perc</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="alibi.explainers.AnchorTabular">AnchorTabular</span></code>, <code><a class="autorefs autorefs-internal" title="mercury.explainability.explainers.explainer.MercuryExplainer" href="#mercury.explainability.explainers.explainer.MercuryExplainer">MercuryExplainer</a></code></p>


        <p>Extending Alibi's AnchorsTabular Implementation, this module allows for the
computation of feature importance by means of calculating several anchors.
Initialize the anchor tabular explainer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>predict_fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model prediction function</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_data</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pandas Dataframe with the features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>disc_perc</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.Union">Union</span>[int, float], ...]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List or tuple with percentiles (int) used for discretization.</p>
              </div>
            </td>
            <td>
                  <code>(25, 50, 75)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>categorical_names</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <span title="typing.List">List</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary where keys are feature columns and values are the categories for the feature</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>AttributeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if categorical_names is not a dict</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>AttributeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if train_data is not a pd.DataFrame</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">explain_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./test/explain_data.csv&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span> <span class="c1"># (Trained) model prediction function (has be callable)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explainer</span> <span class="o">=</span> <span class="n">AnchorsWithImportanceExplainer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">explain_data</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explanation</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">explain_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="c1"># For the first 10 samples</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explanation</span><span class="o">.</span><span class="n">interpret_explanations</span><span class="p">(</span><span class="n">n_important_features</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># We can also get the feature importances for the first 10 samples.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">anchorsExtendedExplainer</span><span class="o">.</span><span class="n">get_feature_importance</span><span class="p">(</span><span class="n">explain_data</span><span class="o">=</span><span class="n">explain_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</code></pre></div>
</details>





                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/anchors.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">predict_fn</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span>
    <span class="n">train_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">categorical_names</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="n">disc_perc</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">categorical_names</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            The attribute categorical_names should be a dictionary</span>
<span class="s2">            where the keys are the categorical feature names and the</span>
<span class="s2">            values are the categories for each categorical feature.</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            train_data should be a pandas DataFrame.</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">predict_fn</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">categorical_names</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">categorical_names</span> <span class="o">=</span> <span class="n">categorical_names</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">train_data</span><span class="o">=</span><span class="n">train_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">disc_perc</span><span class="o">=</span><span class="n">disc_perc</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer.explain" class="doc doc-heading">
            <code class=" language-python"><span class="n">explain</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">coverage_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">beam_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stop_on_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_anchor_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_start</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_covered_ex</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">binary_cache_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">cache_margin</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose_every</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Explain prediction made by classifier on instance <code>X</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>X</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instance to be explained.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum precision threshold.</p>
              </div>
            </td>
            <td>
                  <code>0.95</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>delta</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Used to compute <code>beta</code>.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tau</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Margin between lower confidence bound and minimum precision or upper bound.</p>
              </div>
            </td>
            <td>
                  <code>0.15</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Batch size used for sampling.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>coverage_samples</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples used to estimate coverage from during result search.</p>
              </div>
            </td>
            <td>
                  <code>10000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beam_size</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of anchors extended at each step of new anchors construction.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stop_on_first</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, the beam search algorithm will return the
            first anchor that has satisfies the probability constraint.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_anchor_size</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of features in result.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_samples_start</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Min number of initial samples.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_covered_ex</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many examples where anchors apply to store for each anchor sampled during search
            (both examples where prediction on samples agrees/disagrees with <code>desired_label</code> are stored).</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>binary_cache_size</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result search pre-allocates <code>binary_cache_size</code> batches for storing the binary arrays
                returned during sampling.</p>
              </div>
            </td>
            <td>
                  <code>10000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cache_margin</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When only <code>max(cache_margin, batch_size)</code> positions in the binary cache remain empty, a new cache
            of the same size is pre-allocated to continue buffering samples.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Display updates during the anchor search iterations.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose_every</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency of displayed iterations during anchor search process.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="alibi.api.interfaces.Explanation">Explanation</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>explanation
<code>Explanation</code> object containing the result explaining the instance with additional metadata as attributes.
See usage at <code>AnchorTabular examples</code>_ for details.
.. _AnchorTabular examples:
    https://docs.seldon.io/projects/alibi/en/latest/methods/Anchors.html</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/anchors.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
            <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>
            <span class="n">delta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="n">tau</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
            <span class="n">coverage_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
            <span class="n">beam_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">stop_on_first</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">max_anchor_size</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">min_samples_start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
            <span class="n">n_covered_ex</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
            <span class="n">binary_cache_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
            <span class="n">cache_margin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">verbose_every</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Explanation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Explain prediction made by classifier on instance `X`.</span>

<span class="sd">    Args:</span>
<span class="sd">        X: Instance to be explained.</span>
<span class="sd">        threshold: Minimum precision threshold.</span>
<span class="sd">        delta: Used to compute `beta`.</span>
<span class="sd">        tau: Margin between lower confidence bound and minimum precision or upper bound.</span>
<span class="sd">        batch_size: Batch size used for sampling.</span>
<span class="sd">        coverage_samples: Number of samples used to estimate coverage from during result search.</span>
<span class="sd">        beam_size: The number of anchors extended at each step of new anchors construction.</span>
<span class="sd">        stop_on_first: If ``True``, the beam search algorithm will return the</span>
<span class="sd">                        first anchor that has satisfies the probability constraint.</span>
<span class="sd">        max_anchor_size: Maximum number of features in result.</span>
<span class="sd">        min_samples_start: Min number of initial samples.</span>
<span class="sd">        n_covered_ex: How many examples where anchors apply to store for each anchor sampled during search</span>
<span class="sd">                        (both examples where prediction on samples agrees/disagrees with `desired_label` are stored).</span>
<span class="sd">        binary_cache_size: The result search pre-allocates `binary_cache_size` batches for storing the binary arrays</span>
<span class="sd">                            returned during sampling.</span>
<span class="sd">        cache_margin: When only ``max(cache_margin, batch_size)`` positions in the binary cache remain empty, a new cache</span>
<span class="sd">                        of the same size is pre-allocated to continue buffering samples.</span>
<span class="sd">        verbose: Display updates during the anchor search iterations.</span>
<span class="sd">        verbose_every: Frequency of displayed iterations during anchor search process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        explanation</span>
<span class="sd">            `Explanation` object containing the result explaining the instance with additional metadata as attributes.</span>
<span class="sd">            See usage at `AnchorTabular examples`_ for details.</span>
<span class="sd">            .. _AnchorTabular examples:</span>
<span class="sd">                https://docs.seldon.io/projects/alibi/en/latest/methods/Anchors.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span>
        <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>
        <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
        <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span>
        <span class="n">tau</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
        <span class="n">coverage_samples</span><span class="o">=</span><span class="n">coverage_samples</span><span class="p">,</span>
        <span class="n">beam_size</span><span class="o">=</span><span class="n">beam_size</span><span class="p">,</span>
        <span class="n">stop_on_first</span><span class="o">=</span><span class="n">stop_on_first</span><span class="p">,</span>
        <span class="n">max_anchor_size</span><span class="o">=</span><span class="n">max_anchor_size</span><span class="p">,</span>
        <span class="n">min_samples_start</span><span class="o">=</span><span class="n">min_samples_start</span><span class="p">,</span>
        <span class="n">n_covered_ex</span><span class="o">=</span><span class="n">n_covered_ex</span><span class="p">,</span>
        <span class="n">binary_cache_size</span><span class="o">=</span><span class="n">binary_cache_size</span><span class="p">,</span>
        <span class="n">cache_margin</span><span class="o">=</span><span class="n">cache_margin</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="n">verbose_every</span><span class="o">=</span><span class="n">verbose_every</span>
    <span class="p">)</span>

    <span class="c1"># This attribute makes pickle serialization crash, so we delete it.</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mab&quot;</span><span class="p">):</span>
        <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mab&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">exp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer.get_feature_importance" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_feature_importance</span><span class="p">(</span><span class="n">explain_data</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">print_every</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">print_explanations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_important_features</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>explain_data</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pandas dataframe containing all the instances for which to find an anchor and therefore
obtain feature importances.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>To be used in and passed down to the anchor explainer as defined on Alibi's documentation.
Controls the minimum precision desired when looking for anchors.
Defaults to 0.95.</p>
              </div>
            </td>
            <td>
                  <code>0.95</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_every</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logging information.
Defaults to 0 - No logging</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_explanations</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean that determines whether to print the explanations at the end of the method or not.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_important_features</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of top features that will be printed.
Defaults to 3.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tau</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>To be used in and passed down to the anchos explainer as defined on Alibi's documentation.
Used within the multi-armed bandit part of the optimisation problem.
Defaults to 0.15</p>
              </div>
            </td>
            <td>
                  <code>0.15</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum time to be spent looking for an Anchor in seconds. A value of 0 means that no timeout
is set.
Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="mercury.explainability.explanations.anchors.AnchorsWithImportanceExplanation" href="../explanations/#mercury.explainability.explanations.anchors.AnchorsWithImportanceExplanation">AnchorsWithImportanceExplanation</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list containing all the explanations.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/anchors.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_feature_importance</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">explain_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>
    <span class="n">print_every</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">print_explanations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">n_important_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">tau</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnchorsWithImportanceExplanation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        explain_data:</span>
<span class="sd">            Pandas dataframe containing all the instances for which to find an anchor and therefore</span>
<span class="sd">            obtain feature importances.</span>
<span class="sd">        threshold: To be used in and passed down to the anchor explainer as defined on Alibi&#39;s documentation.</span>
<span class="sd">            Controls the minimum precision desired when looking for anchors.</span>
<span class="sd">            Defaults to 0.95.</span>
<span class="sd">        print_every:</span>
<span class="sd">            Logging information.</span>
<span class="sd">            Defaults to 0 - No logging</span>
<span class="sd">        print_explanations:</span>
<span class="sd">            Boolean that determines whether to print the explanations at the end of the method or not.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        n_important_features:</span>
<span class="sd">            Number of top features that will be printed.</span>
<span class="sd">            Defaults to 3.</span>
<span class="sd">        tau:</span>
<span class="sd">            To be used in and passed down to the anchos explainer as defined on Alibi&#39;s documentation.</span>
<span class="sd">            Used within the multi-armed bandit part of the optimisation problem.</span>
<span class="sd">            Defaults to 0.15</span>
<span class="sd">        timeout:</span>
<span class="sd">            Maximum time to be spent looking for an Anchor in seconds. A value of 0 means that no timeout</span>
<span class="sd">            is set.</span>
<span class="sd">            Defaults to 0.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list containing all the explanations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">explanations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">print_every</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Looking for a total of </span><span class="si">{}</span><span class="s1"> explanations&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">explain_data</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">explain_datum_idx</span><span class="p">,</span> <span class="n">explain_datum</span> <span class="ow">in</span> <span class="n">explain_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">explanation</span> <span class="o">=</span> <span class="n">run_until_timeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">explain</span><span class="p">,</span>
                              <span class="n">explain_datum</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                              <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                              <span class="n">tau</span><span class="o">=</span><span class="n">tau</span><span class="p">)</span>
            <span class="n">explanations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">explanation</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">print_every</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No anchor found for observation </span><span class="si">{}</span><span class="s1">&#39;</span>
                                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">explain_datum_idx</span><span class="p">))</span>
            <span class="n">explanations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;No explanation&#39;</span><span class="p">)</span>

        <span class="c1"># Unset timeout</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">print_every</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">explanations</span><span class="p">)</span> <span class="o">%</span> <span class="n">print_every</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;&quot;&quot;A total of </span><span class="si">{}</span><span class="s2"> observations have been processed &quot;&quot;&quot;</span> <span class="o">+</span>
<span class="w">                        </span><span class="sd">&quot;&quot;&quot;for explaining&quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">explanations</span><span class="p">)))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> anchors have already been found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">explan</span> <span class="ow">in</span> <span class="n">explanations</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">explan</span><span class="p">,</span> <span class="nb">str</span><span class="p">)])</span>
                <span class="p">))</span>
    <span class="c1"># Here we have a list with all the anchors explanations that we&#39;ve been able to find.</span>
    <span class="n">anchorsExtendedExplanation</span> <span class="o">=</span> <span class="n">AnchorsWithImportanceExplanation</span><span class="p">(</span>
        <span class="n">explain_data</span><span class="o">=</span><span class="n">explain_data</span><span class="p">,</span>
        <span class="n">explanations</span><span class="o">=</span><span class="n">explanations</span><span class="p">,</span>
        <span class="n">categorical</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">categorical_names</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">print_explanations</span><span class="p">:</span>
        <span class="n">anchorsExtendedExplanation</span><span class="o">.</span><span class="n">interpret_explanations</span><span class="p">(</span>
            <span class="n">n_important_features</span><span class="o">=</span><span class="n">n_important_features</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">anchorsExtendedExplanation</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer.save" class="doc doc-heading">
            <code class=" language-python"><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Overwrite to ensure that we use MercuryExplainer.save</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/anchors.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Overwrite to ensure that we use MercuryExplainer.save&quot;&quot;&quot;</span>
    <span class="n">MercuryExplainer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.anchors.AnchorsWithImportanceExplainer.translate" class="doc doc-heading">
            <code class=" language-python"><span class="n">translate</span><span class="p">(</span><span class="n">explanation</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Translates an explanation into simple words</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>explanation</code>
            </td>
            <td>
                  <code><span title="alibi.api.interfaces.Explanation">Explanation</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alibi explanation object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/anchors.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">explanation</span><span class="p">:</span> <span class="n">Explanation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translates an explanation into simple words</span>

<span class="sd">    Args:</span>
<span class="sd">        explanation: Alibi explanation object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">coverage</span> <span class="o">=</span> <span class="n">explanation</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;coverage&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">explanation</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="n">explanation</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="n">explanation</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">coverage</span> <span class="o">*</span> <span class="n">precision</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="s2">&quot;POOR&quot;</span>
    <span class="k">elif</span> <span class="mf">0.1</span> <span class="o">&lt;=</span> <span class="n">coverage</span> <span class="o">*</span> <span class="n">precision</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">:</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="s2">&quot;GOOD&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="s2">&quot;GREAT&quot;</span>

    <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">{}</span><span class="s2"> explanation] This anchor explains a </span><span class="si">{}% o</span><span class="s2">f all records of its class with </span><span class="si">{}% c</span><span class="s2">onfidence.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">quality</span><span class="p">,</span>
        <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">coverage</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">precision</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.explainability.explainers.cf_strategies" class="doc doc-heading">
            <code>cf_strategies</code>


</h3>

    <div class="doc doc-contents ">

        <p>Optimization strategies for simple counterfactual explanations.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.cf_strategies.Backtracking" class="doc doc-heading">
              <code class=" language-python"><span class="n">Backtracking</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">class_idx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keep_explored_points</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="mercury.explainability.explainers.cf_strategies.Strategy" href="#mercury.explainability.explainers.cf_strategies.Strategy">Strategy</a></code></p>


        <p>Backtracking strategy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial state (initial starting point).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bounds</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bounds to be used when moving around the probability space defined by <code>fn</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Step size values to be used when moving around the probability space defined by <code>fn</code>.
Lower values may take more time/steps to find a solution while too large values may
make impossible to find a solution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="pandas.DataFrame">DataFrame</span>]], <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Classifier <code>predict_proba</code>- like function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>class_idx</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Class to be explained (e.g. 1 for binary classifiers). Default value is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability to be achieved (if path is found). Default value is 0.0.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kernel</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Used to penalize certain dimensions when trying to move around the probability
space (some dimensions may be more difficult to explain, hence don't move along them).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>report</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to display probability updates during space search.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>keep_explored_points</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to keep the points that the algorithm explores. Setting it to False will
decrease the computation time and memory usage in some cases. Default value is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>






                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/cf_strategies.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">state</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span>
             <span class="n">bounds</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span>
             <span class="n">step</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span>
             <span class="n">fn</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]],</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">],</span>
             <span class="n">class_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span>
             <span class="n">kernel</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">report</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">keep_explored_points</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">class_idx</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">report</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">keep_explored_points</span> <span class="o">=</span> <span class="n">keep_explored_points</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.cf_strategies.Backtracking.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Kick off the backtracking.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Backtracking specific arguments
        - max_iter: max number of iterations</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>result</code></td>            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, float, <span title="numpy.ndarray">ndarray</span>, <span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple containing found solution, probability achieved, points visited and
corresponding energies (i.e. probabilities).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/cf_strategies.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TP</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span> <span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Kick off the backtracking.</span>

<span class="sd">    Args:</span>
<span class="sd">        **kwargs (dict): Backtracking specific arguments</span>
<span class="sd">                    - max_iter: max number of iterations</span>

<span class="sd">    Returns:</span>
<span class="sd">        result (TP.Tuple[&#39;np.ndarray&#39;, float, &#39;np.ndarray&#39;, TP.Optional[&#39;np.ndarray&#39;]]):</span>
<span class="sd">            Tuple containing found solution, probability achieved, points visited and</span>
<span class="sd">            corresponding energies (i.e. probabilities).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Backtracking specific arguments</span>
    <span class="k">if</span> <span class="s1">&#39;max_iter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">max_iter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="s1">&#39;limit&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s1">&#39;shuffle_limit&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">shuffle_limit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;shuffle_limit&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shuffle_limit</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Backtracking starting point.</span>
    <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">curr_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="n">point</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_idx</span><span class="p">]</span>
    <span class="n">best_point</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">best_prob</span> <span class="o">=</span> <span class="n">curr_prob</span>

    <span class="c1"># Define condition (&gt;= or &lt;=) from current point and given threshold.</span>
    <span class="c1"># and the priority modifier (ascending or descending order) using prio_mod.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">&gt;</span> <span class="n">curr_prob</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="nb">float</span><span class="o">.</span><span class="fm">__ge__</span>
        <span class="n">prio_mod</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="nb">float</span><span class="o">.</span><span class="fm">__le__</span>
        <span class="n">prio_mod</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="mf">1.1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span>

    <span class="n">visited</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">point</span><span class="p">,</span> <span class="p">[[</span><span class="n">curr_prob</span><span class="p">]]])</span>
    <span class="n">explored</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">point</span><span class="p">,</span> <span class="p">[[</span><span class="n">curr_prob</span><span class="p">]]])</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_explored_points</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">MyPriorityQueue</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
    <span class="c1"># Avoid duplicates and querying known points.</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">tolist</span><span class="p">()):</span> <span class="n">curr_prob</span><span class="p">}</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">]</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">condition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span> <span class="n">curr_prob</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">max_iter</span> <span class="ow">or</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="n">max_iter</span><span class="p">):</span>
        <span class="c1"># Explore neighbours.</span>
        <span class="n">neighbours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="n">neighbours_l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">neighbours_kernel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">local_cache</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p_</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">delta</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">):</span>
                <span class="c1"># In every direction.</span>
                <span class="k">for</span> <span class="n">sign</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">aux</span> <span class="o">=</span> <span class="n">p_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">new_aux_i</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">delta</span>
                    <span class="k">if</span> <span class="n">new_aux_i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">new_aux_i</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_aux_i</span>
                        <span class="n">aux_l</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                        <span class="n">str_aux_l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">aux_l</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">str_aux_l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span> <span class="ow">and</span> <span class="n">str_aux_l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_cache</span><span class="p">:</span>
                            <span class="c1"># If point is not in cache (visited) -&gt; enqueue.</span>
                            <span class="n">neighbours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">neighbours</span><span class="p">,</span> <span class="n">aux</span><span class="p">])</span>
                            <span class="n">neighbours_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_l</span><span class="p">)</span>
                            <span class="n">neighbours_kernel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="n">local_cache</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">str_aux_l</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbours_l</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">neighbours</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbours_kernel</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbours_l</span><span class="p">),</span> \
                <span class="s1">&#39;Number of neighbours should match.&#39;</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="n">neighbours</span><span class="p">)[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_idx</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">n_idx</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="nb">range</span><span class="p">(</span><span class="n">probs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">neighbours_kernel</span><span class="p">,</span> <span class="n">neighbours_l</span><span class="p">):</span>
                <span class="n">prob</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">probs</span><span class="p">[</span><span class="n">n_idx</span><span class="p">])</span>
                <span class="n">prio</span> <span class="o">=</span> <span class="n">prob</span> <span class="o">*</span> <span class="n">kernel</span>
                <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">prio_mod</span><span class="p">(</span><span class="n">prio</span><span class="p">),</span> <span class="n">prob</span><span class="p">,</span> <span class="n">pt</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_explored_points</span><span class="p">:</span>
                    <span class="n">explored</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">explored</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">neighbours</span><span class="p">[</span><span class="n">n_idx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">[[</span><span class="n">prob</span><span class="p">]]])])</span>
                <span class="n">cache</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pt</span><span class="p">)]</span> <span class="o">=</span> <span class="n">prob</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">get_same_priority</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shuffle_limit</span><span class="o">=</span><span class="n">shuffle_limit</span><span class="p">)</span>
            <span class="n">curr_prob</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">])</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">queue</span><span class="o">.</span><span class="n">Empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visited</span> <span class="o">=</span> <span class="n">visited</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">explored</span> <span class="o">=</span> <span class="n">explored</span>
            <span class="k">return</span> <span class="n">best_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">best_prob</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">explored</span>
        <span class="k">if</span> <span class="n">condition</span><span class="p">(</span><span class="n">curr_prob</span><span class="p">,</span> <span class="n">best_prob</span><span class="p">):</span>
            <span class="n">best_prob</span> <span class="o">=</span> <span class="n">curr_prob</span>
            <span class="n">best_point</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="n">visited</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">visited</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">point</span><span class="p">,</span>
                                                     <span class="p">[[</span><span class="n">curr_prob</span><span class="p">]]])])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">:</span>

            <span class="n">iter_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_iter</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">update_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="si">{</span><span class="n">iter_string</span><span class="si">}</span><span class="se">\t\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">best_prob</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">Iteration</span><span class="se">\t</span><span class="s1">Best Prob&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">update_string</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">update_string</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">max_iter</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">explored</span> <span class="o">=</span> <span class="n">explored</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">visited</span> <span class="o">=</span> <span class="n">visited</span>
    <span class="k">return</span> <span class="n">best_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">best_prob</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">explored</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.cf_strategies.SimulatedAnnealing" class="doc doc-heading">
              <code class=" language-python"><span class="n">SimulatedAnnealing</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">class_idx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="mercury.explainability.explainers.cf_strategies.Strategy" href="#mercury.explainability.explainers.cf_strategies.Strategy">Strategy</a></code>, <code><span title="simanneal.Annealer">Annealer</span></code></p>


        <p>Simulated Annealing strategy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial state (initial starting point).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bounds</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bounds to be used when moving around the probability space defined by <code>fn</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Step size values to be used when moving around the probability space defined by <code>fn</code>.
Lower values may take more time/steps to find a solution while too large values may
make impossible to find a solution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="pandas.DataFrame">DataFrame</span>]], <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Classifier <code>predict_proba</code>- like function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>class_idx</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Class to be explained (e.g. 1 for binary classifiers). Default value is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability to be achieved (if path is found). Default value is 0.0.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kernel</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Used to penalize certain dimensions when trying to move around the probability
space (some dimensions may be more difficult to explain, hence don't move along them).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>report</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to display probability updates during space search.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>






                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/cf_strategies.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">state</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span>
             <span class="n">bounds</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span>
             <span class="n">step</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span>
             <span class="n">fn</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]],</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">],</span>
             <span class="n">class_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span>
             <span class="n">kernel</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">report</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">Strategy</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">class_idx</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">report</span><span class="p">)</span>
    <span class="c1"># Annealer&#39;s __init__ uses signal, see Annealers&#39;s init:</span>
    <span class="c1"># https://github.com/perrygeo/simanneal/blob/b2576eb75d88f8b8c91d959a44dd708706bb108e/simanneal/anneal.py#L52</span>
    <span class="c1"># This may break execution (depending on where simanneal runs, e.g. threads)</span>
    <span class="c1"># Overload it!</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Annealer</span><span class="o">.</span><span class="n">copy_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.cf_strategies.SimulatedAnnealing.best_solution" class="doc doc-heading">
            <code class=" language-python"><span class="n">best_solution</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the n best solutions found during the Simulated Annealing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of solutions to be retrieved. Default value is 3.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/cf_strategies.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">best_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Returns the n best solutions found during the Simulated Annealing.</span>

<span class="sd">    Args:</span>
<span class="sd">        n (int): Number of solutions to be retrieved. Default value is 3.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explored</span><span class="p">))[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_idx</span><span class="p">]</span>
    <span class="n">sorted_ps_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
        <span class="n">sorted_ps_idxs</span> <span class="o">=</span> <span class="n">sorted_ps_idxs</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explored</span><span class="p">)[</span><span class="n">sorted_ps_idxs</span><span class="p">[:</span><span class="n">n</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.cf_strategies.SimulatedAnnealing.energy" class="doc doc-heading">
            <code class=" language-python"><span class="n">energy</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Energy step in Simulated Annealing.</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/cf_strategies.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Energy step in Simulated Annealing. &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_idx</span><span class="p">]</span>
    <span class="c1"># energy check</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">p</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="k">else</span> <span class="o">-</span><span class="n">p</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.cf_strategies.SimulatedAnnealing.move" class="doc doc-heading">
            <code class=" language-python"><span class="n">move</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Move step in Simulated Annealing.</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/cf_strategies.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Move step in Simulated Annealing. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">explored</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.cf_strategies.SimulatedAnnealing.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Kick off Simulated Annealing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Simulated Annealing specific arguments
    - tmin: min temperature
    - tmax: max temperature
    - steps: number of iterations</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>result</code></td>            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, float, <span title="numpy.ndarray">ndarray</span>, <span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple containing found solution, probability achieved, points visited and
corresponding energies (i.e. probabilities).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/cf_strategies.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TP</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span> <span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Kick off Simulated Annealing.</span>

<span class="sd">    Args:</span>
<span class="sd">        **kwargs (dict):</span>
<span class="sd">            Simulated Annealing specific arguments</span>
<span class="sd">                - tmin: min temperature</span>
<span class="sd">                - tmax: max temperature</span>
<span class="sd">                - steps: number of iterations</span>

<span class="sd">    Returns:</span>
<span class="sd">        result (TP.Tuple[&#39;np.ndarray&#39;, float, &#39;np.ndarray&#39;, TP.Optional[&#39;np.ndarray&#39;]]):</span>
<span class="sd">            Tuple containing found solution, probability achieved, points visited and</span>
<span class="sd">            corresponding energies (i.e. probabilities).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s1">&#39;tmin&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tmin&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;tmax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tmax&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;steps&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span>
        <span class="c1"># self.updates = 100</span>
    <span class="n">sol</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">anneal</span><span class="p">()</span>  <span class="c1"># type: TP.Tuple[&#39;np.ndarray&#39;, float]</span>
    <span class="k">return</span> <span class="n">sol</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explored</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.cf_strategies.Strategy" class="doc doc-heading">
              <code class=" language-python"><span class="n">Strategy</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">class_idx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">


        <p>Base class for explanation strategies.</p>






                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/cf_strategies.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">state</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span>
             <span class="n">bounds</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span>
             <span class="n">step</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span>
             <span class="n">fn</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]],</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">],</span>
             <span class="n">class_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span>
             <span class="n">kernel</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">report</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

    <span class="c1"># Starting point</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
    <span class="c1"># Dimension bounds</span>
    <span class="k">assert</span> <span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span>
    <span class="k">assert</span> <span class="n">step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
    <span class="c1"># Classifier fn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
    <span class="c1"># Class</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">class_idx</span> <span class="o">=</span> <span class="n">class_idx</span>
    <span class="c1"># Explored points</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">explored</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">]</span>
    <span class="c1"># Probability threshold</span>
    <span class="k">assert</span> <span class="n">threshold</span> <span class="o">&gt;=</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="n">threshold</span> <span class="o">&lt;=</span> <span class="mf">1.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
    <span class="c1"># Energies</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">energies</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="c1"># Kernel</span>
    <span class="k">if</span> <span class="n">kernel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># minimization or maximization problem?</span>
    <span class="n">cur_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_idx</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cur_prob</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">=</span> <span class="n">report</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.explainability.explainers.clustering_tree_explainer" class="doc doc-heading">
            <code>clustering_tree_explainer</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.clustering_tree_explainer.ClusteringTreeExplainer" class="doc doc-heading">
              <code class=" language-python"><span class="n">ClusteringTreeExplainer</span><span class="p">(</span><span class="n">clustering_model</span><span class="p">,</span> <span class="n">max_leaves</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">base_tree</span><span class="o">=</span><span class="s1">&#39;IMM&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="mercury.explainability.explainers.explainer.MercuryExplainer" href="#mercury.explainability.explainers.explainer.MercuryExplainer">MercuryExplainer</a></code></p>


        <p>ClusteringTreeExplainer explains a clustering model using a DecisionTree.</p>
<p>It is based on the method Iterative Mistake Minimization (IMM).
The high-level idea is to find build a decision tree with the same number of leaves as the number of clusters. The tree is build
by using the predicted clusters of a dataset using some previously fitted clustering model (like K-means) and fitting the
decision tree using the clusters as labels. At each step, the a node with containing two or more of reference centres is split
so the resulting split sends at least one reference centre to each side and moreover produces the fewest mistakes: that is,
separates the minimum points from their corresponding centres.</p>
<p>There is also de option to create a decision tree with a higher number of leaves than clusters. This is based on the ExKMC method,
which is an extension of the IMM algorithm. The goal in this case is to achieve fewer mistakes in the resulting decision tree,
with the trade-off that it will be less explainable. You can see more details of the methods in the referenced papers below</p>
<p>In this implementation, the clustering solution can be created before using the ClusteringTreeExplainer. Otherwise,
a k-means with default parameters is created before fitting the decision tree.</p>


<details class="references" open>
  <summary>References</summary>
  <p><strong>"Explainable k-Means and k-Medians Clustering"</strong>: (http://proceedings.mlr.press/v119/moshkovitz20a/moshkovitz20a.pdf)
<strong>"ExKMC: Expanding Explainable k-Means Clustering"</strong>: (https://arxiv.org/pdf/2006.02399.pdf)</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>clustering_model</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="sklearn.base.BaseEstimator">BaseEstimator</span>, <span title="pyspark.ml.base.Model">Model</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The clustering model fitted. It supports sklearn and pyspark.
When using sklearn, the model must be a sklearn <code>BaseEstimator</code> with a <code>predict</code> method and <code>cluster_centers_</code> attribute
(like KMeans). Alternatively, you can provide a fitted pipeline where the last stage is the clustering algorithm.
When using pyspark, the clustering_model must be a fitted Pyspark Estimator containing <code>clusterCenters()</code> method (like pyspark
Kmeans). Alternatively, you can provide a fitted Pyspark <code>PipelineModel</code> where the last stage of the pipeline contains
the clustering algorithm and contains the `clusterCenters()' method.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_leaves</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the maximum number of leaves. If max_leaves == k, then the method is the Iterative Mistake Minimization (IMM). If
max_leaves &gt; k, then the method to expand the tree further than k leaves is ExKMC. It cannot be max_leaves &lt; k</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to show some messages during the process. If 0, it doesn't show any message. If &gt;=1 show messages.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>base_tree</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>method to use to build the tree. If <code>'IMM'</code> it build a tree with k leaves using the IMM method and then it expands it
using the ExKMC method if max_leaves &gt; k. If <code>None</code> then it uses ExKMC method of splitting nodes from the root node. The default
and recommended option is <code>'IMM'</code></p>
              </div>
            </td>
            <td>
                  <code>&#39;IMM&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_jobs</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of jobs</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>seed to use</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">mercury.explainability.explainers.clustering_tree_explainer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClusteringTreeExplainer</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">KMeans</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">4</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">clustering_tree_explainer</span> <span class="o">=</span> <span class="n">ClusteringTreeExplainer</span><span class="p">(</span><span class="n">clustering_model</span><span class="o">=</span><span class="n">kmeans</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">max_leaves</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explanation</span> <span class="o">=</span> <span class="n">clustering_tree_explainer</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plot_explanation</span> <span class="o">=</span> <span class="n">explanation</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;explanation&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plot_explanation</span>
</code></pre></div>
</details>





                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/clustering_tree_explainer.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">clustering_model</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;sklearn.base.BaseEstimator&quot;</span><span class="p">,</span> <span class="s2">&quot;pyspark.ml.base.Model&quot;</span><span class="p">],</span>  <span class="c1"># noqa: F821</span>
    <span class="n">max_leaves</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">base_tree</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;IMM&#39;</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">clustering_model</span> <span class="o">=</span> <span class="n">clustering_model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">all_centers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cluster_centers</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_centers</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_leaves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="k">if</span> <span class="n">max_leaves</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">max_leaves</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_leaves</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;max_trees must be greater or equal to number of clusters [</span><span class="si">%d</span><span class="s1"> &lt; </span><span class="si">%d</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_leaves</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="k">if</span> <span class="n">base_tree</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">BASE_TREE</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">base_tree</span> <span class="o">+</span> <span class="s1">&#39; is not a supported base tree&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_tree</span> <span class="o">=</span> <span class="n">base_tree</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span> <span class="o">=</span> <span class="n">n_jobs</span> <span class="k">if</span> <span class="n">n_jobs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_feature_importance</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.clustering_tree_explainer.ClusteringTreeExplainer.explain" class="doc doc-heading">
            <code class=" language-python"><span class="n">explain</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">subsample</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Create explanation for clustering algorithm.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>X</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="pyspark.sql.DataFrame">DataFrame</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>inputs of the data that we are clustering</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subsample</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>percentage of <code>X</code> to subsample (only when using pyspark)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="mercury.explainability.explanations.clustering_tree_explanation.ClusteringTreeExplanation" href="../explanations/#mercury.explainability.explanations.clustering_tree_explanation.ClusteringTreeExplanation">ClusteringTreeExplanation</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ClusteringTreeExplanation object, which contains plot() method to display the built decision tree</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/clustering_tree_explainer.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">explain</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">X</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;pandas.DataFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;pyspark.sql.DataFrame&quot;</span><span class="p">],</span>  <span class="c1"># noqa: F821</span>
    <span class="n">subsample</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClusteringTreeExplanation</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create explanation for clustering algorithm.</span>

<span class="sd">    Args:</span>
<span class="sd">        X: inputs of the data that we are clustering</span>
<span class="sd">        subsample: percentage of `X` to subsample (only when using pyspark)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ClusteringTreeExplanation object, which contains plot() method to display the built decision tree</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">feature_names</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cluster_labels_pandas</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cluster_labels_pyspark</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">subsample</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span>
        <span class="n">base_tree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_tree</span><span class="p">,</span> <span class="n">max_leaves</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_leaves</span><span class="p">,</span> <span class="n">all_centers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all_centers</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ClusteringTreeExplanation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.clustering_tree_explainer.ClusteringTreeExplainer.score" class="doc doc-heading">
            <code class=" language-python"><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Return the k-means cost of X.
The k-means cost is the sum of squared distances of each point to the mean of points associated with the cluster.
Args:
    X: The input samples.
Returns:
    k-means cost of X.</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/clustering_tree_explainer.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the k-means cost of X.</span>
<span class="sd">    The k-means cost is the sum of squared distances of each point to the mean of points associated with the cluster.</span>
<span class="sd">    Args:</span>
<span class="sd">        X: The input samples.</span>
<span class="sd">    Returns:</span>
<span class="sd">        k-means cost of X.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">_convert_input</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">):</span>
        <span class="n">cluster_data</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">clusters</span> <span class="o">==</span> <span class="n">c</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="n">cluster_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">cluster_data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">cost</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">cluster_data</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">cost</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.clustering_tree_explainer.ClusteringTreeExplainer.surrogate_score" class="doc doc-heading">
            <code class=" language-python"><span class="n">surrogate_score</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Return the k-means surrogate cost of X.
The k-means surrogate cost is the sum of squared distances of each point to the closest center of the kmeans given (or trained)
in the fit method. k-means surrogate cost &gt; k-means cost, as k-means cost is computed with respect to the optimal centers.
Args:
    X: The input samples.
Returns:
    k-means surrogate cost of X.</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/clustering_tree_explainer.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">surrogate_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the k-means surrogate cost of X.</span>
<span class="sd">    The k-means surrogate cost is the sum of squared distances of each point to the closest center of the kmeans given (or trained)</span>
<span class="sd">    in the fit method. k-means surrogate cost &gt; k-means cost, as k-means cost is computed with respect to the optimal centers.</span>
<span class="sd">    Args:</span>
<span class="sd">        X: The input samples.</span>
<span class="sd">    Returns:</span>
<span class="sd">        k-means surrogate cost of X.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">_convert_input</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">):</span>
        <span class="n">cluster_data</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">clusters</span> <span class="o">==</span> <span class="n">c</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="n">cluster_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_centers</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">cost</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">cluster_data</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">cost</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.clustering_tree_explainer.Tree" class="doc doc-heading">
              <code class=" language-python"><span class="n">Tree</span><span class="p">(</span><span class="n">base_tree</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">max_leaves</span><span class="p">,</span> <span class="n">all_centers</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">n_jobs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">







                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/clustering_tree_explainer.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_tree</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">max_leaves</span><span class="p">,</span> <span class="n">all_centers</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">n_jobs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_tree</span> <span class="o">=</span> <span class="n">base_tree</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_leaves</span> <span class="o">=</span> <span class="n">max_leaves</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">all_centers</span> <span class="o">=</span> <span class="n">all_centers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span> <span class="o">=</span> <span class="n">n_jobs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_leaves_data</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.clustering_tree_explainer.Tree.__max_depth__" class="doc doc-heading">
            <code class=" language-python"><span class="n">__max_depth__</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Return the depth of the subtree rooted by node.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node</code>
            </td>
            <td>
                  <code><span title="mercury.explainability.explainers.clustering_tree_explainer.Node">Node</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>root of a subtree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns (int):
    The depth of the subtree rooted by node.</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/clustering_tree_explainer.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__max_depth__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the depth of the subtree rooted by node.</span>

<span class="sd">    Args:</span>
<span class="sd">        node: root of a subtree.</span>

<span class="sd">    Returns (int):</span>
<span class="sd">        The depth of the subtree rooted by node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__max_depth__</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__max_depth__</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span> <span class="n">dr</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.clustering_tree_explainer.Tree.__size__" class="doc doc-heading">
            <code class=" language-python"><span class="n">__size__</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Return the number of nodes in the subtree rooted by node.
Args:
    node: root of a subtree.
Returns
    the number of nodes in the subtree rooted by node.</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/clustering_tree_explainer.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__size__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the number of nodes in the subtree rooted by node.</span>
<span class="sd">    Args:</span>
<span class="sd">        node: root of a subtree.</span>
<span class="sd">    Returns</span>
<span class="sd">        the number of nodes in the subtree rooted by node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__size__</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
        <span class="n">sr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__size__</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sl</span> <span class="o">+</span> <span class="n">sr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.clustering_tree_explainer.Tree._build_tree" class="doc doc-heading">
            <code class=" language-python"><span class="n">_build_tree</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">valid_centers</span><span class="p">,</span> <span class="n">valid_cols</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Build a tree.</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/clustering_tree_explainer.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_build_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">valid_centers</span><span class="p">,</span> <span class="n">valid_cols</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;build node (samples=</span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">node</span>
    <span class="k">elif</span> <span class="n">valid_centers</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">valid_centers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">node</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># Verify data type is float64 prior to cython call</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_centers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_centers</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">valid_centers</span> <span class="o">=</span> <span class="n">valid_centers</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">valid_cols</span> <span class="o">=</span> <span class="n">valid_cols</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">cut</span> <span class="o">=</span> <span class="n">get_min_mistakes_cut</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_centers</span><span class="p">,</span> <span class="n">valid_centers</span><span class="p">,</span> <span class="n">valid_cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">valid_centers</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">cut</span><span class="p">[</span><span class="s2">&quot;col&quot;</span><span class="p">]</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="n">cut</span><span class="p">[</span><span class="s2">&quot;threshold&quot;</span><span class="p">]</span>
                <span class="n">node</span><span class="o">.</span><span class="n">set_condition</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>

                <span class="n">left_data_mask</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">threshold</span>
                <span class="n">matching_centers_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_centers</span><span class="p">[:,</span> <span class="n">col</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">threshold</span>
                <span class="n">mistakes_mask</span> <span class="o">=</span> <span class="n">left_data_mask</span> <span class="o">!=</span> <span class="n">matching_centers_mask</span>

                <span class="n">left_valid_centers_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_centers</span><span class="p">[</span><span class="n">valid_centers</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span> <span class="n">col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">threshold</span>
                <span class="n">left_valid_centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">valid_centers</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                <span class="n">left_valid_centers</span><span class="p">[</span><span class="n">valid_centers</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)]</span> <span class="o">=</span> <span class="n">left_valid_centers_mask</span>
                <span class="n">right_valid_centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">valid_centers</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                <span class="n">right_valid_centers</span><span class="p">[</span><span class="n">valid_centers</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)]</span> <span class="o">=</span> <span class="o">~</span><span class="n">left_valid_centers_mask</span>

                <span class="n">node</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_tree</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">left_data_mask</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mistakes_mask</span><span class="p">],</span>
                                             <span class="n">y</span><span class="p">[</span><span class="n">left_data_mask</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mistakes_mask</span><span class="p">],</span>
                                             <span class="n">left_valid_centers</span><span class="p">,</span>
                                             <span class="n">valid_cols</span><span class="p">)</span>
                <span class="n">node</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_tree</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">left_data_mask</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mistakes_mask</span><span class="p">],</span>
                                              <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">left_data_mask</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mistakes_mask</span><span class="p">],</span>
                                              <span class="n">right_valid_centers</span><span class="p">,</span>
                                              <span class="n">valid_cols</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">node</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.clustering_tree_explainer.Tree._max_depth" class="doc doc-heading">
            <code class=" language-python"><span class="n">_max_depth</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Return the depth of the threshold tree.</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/clustering_tree_explainer.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_max_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the depth of the threshold tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__max_depth__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.clustering_tree_explainer.Tree._size" class="doc doc-heading">
            <code class=" language-python"><span class="n">_size</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Return the number of nodes in the threshold tree.</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/clustering_tree_explainer.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the number of nodes in the threshold tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__size__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.clustering_tree_explainer.Tree.predict" class="doc doc-heading">
            <code class=" language-python"><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Predict clusters for X.
    X: The input samples.
Returns:
    The predicted clusters.</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/clustering_tree_explainer.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Predict clusters for X.</span>
<span class="sd">        X: The input samples.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The predicted clusters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">_convert_input</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_subtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.explainability.explainers.counter_fact_basic" class="doc doc-heading">
            <code>counter_fact_basic</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.counter_fact_basic.CounterFactualExplainerBasic" class="doc doc-heading">
              <code class=" language-python"><span class="n">CounterFactualExplainerBasic</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="mercury.explainability.explainers.explainer.MercuryExplainer" href="#mercury.explainability.explainers.explainer.MercuryExplainer">MercuryExplainer</a></code></p>


        <p>Explains predictions on tabular (i.e. matrix) data for binary/multiclass classifiers.
Currently two main strategies are implemented: one following a backtracking strategy and
another following a probabilistic process (simulated annealing strategy).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>train</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="pandas.DataFrame">DataFrame</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Training dataset to extract feature bounds from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="pandas.DataFrame">DataFrame</span>]], <span title="typing.Union">Union</span>[float, <span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Classifier <code>predict_proba</code>-like function. Note that the returned probabilities
must be valid, ie. the values must be between 0 and 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>labels</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of labels to be used when plotting results. If DataFrame used, labels take
dataframe column names. Default is empty list.</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bounds</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feature bounds used when no train data is provided (shape must match labels').
Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_steps</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter used to indicate how small/large steps should be when exploring
the space (default is 200).</p>
              </div>
            </td>
            <td>
                  <code>200</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>AssertionError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if bounds.size &lt;= 0 when no train data is provided |
if bounds.ndim != 2 when no train data is provided |
if bounds.shape[1] != 2 when no train data is provided |
if bounds.shape[0] != len(labels)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>TypeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if train is not a DataFrame or numpy array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/counter_fact_basic.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">train</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">],</span> <span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]],</span>
             <span class="n">fn</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]],</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">]],</span>
             <span class="n">labels</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
             <span class="n">bounds</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">n_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">train</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># If data is not provided, labels and bounds are required</span>
        <span class="k">assert</span> <span class="n">bounds</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bounds are required if no data is provided&#39;</span>
        <span class="k">assert</span> <span class="n">bounds</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;min/max values are required for each feature&#39;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
            <span class="s1">&#39;Labels and bound shapes must match, got </span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1"> respectively&#39;</span> \
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span> <span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># min/max values for each feature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Compute bounds</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
                <span class="s1">&#39;Labels and bound shapes must match, got </span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1"> respectively&#39;</span> \
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span>
                <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">train</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">train</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
                <span class="s1">&#39;Labels and bound shapes must match, got </span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1"> respectively&#39;</span> \
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Invalid type for argument train, got </span><span class="si">{}</span><span class="s1"> but expected numpy array or pandas dataframe&#39;</span><span class="o">.</span>
                            <span class="nb">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">train</span><span class="p">)))</span>

    <span class="c1"># Compute steps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_steps</span> <span class="o">=</span> <span class="n">n_steps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_steps</span>

    <span class="c1"># Function to be evaluated on optimization</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.counter_fact_basic.CounterFactualExplainerBasic.explain" class="doc doc-heading">
            <code class=" language-python"><span class="n">explain</span><span class="p">(</span><span class="n">from_</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">class_idx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;backtracking&#39;</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keep_explored_points</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Roll the panellet down the valley and find an explanation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>from_</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting point.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability to be achieved (if path is found).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>class_idx</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Class to be explained (e.g. 1 for binary classifiers).</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kernel</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Used to penalize certain dimensions when trying to move around
the probability space (some dimensions may be more difficult to explain,
hence don't move along them). Default is np.ones(n), meaning all dimensions
can be used to move around the space (must be a value between 0 and 1).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bounds</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feature bound values to be used when exploring the probability space. If not
specified, the ones extracted from the training data are used instead.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Step values to be used when moving around the probability space. If not specified,
training bounds are divided by 200 (arbitrary value) and these are used as step value.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strategy</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If 'backtracking', the backtracking strategy is used to move around the probability space.
If 'simanneal', the simulated annealing strategy is used to move around the probability space.</p>
              </div>
            </td>
            <td>
                  <code>&#39;backtracking&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>report</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to report the algorithm progress during the execution.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>keep_explored_points</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to keep the points that the algorithm explores. Setting it to False will decrease
the computation time and memory usage in some cases. Default value is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>AssertionError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>from_</code> number of dimensions is != 1 |
If <code>from_</code> shape does not match <code>bounds</code> shape |
If <code>bounds</code> shape is not valid |
If <code>step</code> shape does not match <code>bounds</code> shape |</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if strategy is not 'backtacking' or 'simanneal'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>explanation</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="mercury.explainability.explanations.counter_factual.CounterfactualBasicExplanation" href="../explanations/#mercury.explainability.explanations.counter_factual.CounterfactualBasicExplanation">CounterfactualBasicExplanation</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>CounterfactualBasicExplanation with the solution found and how it differs from the starting point.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/counter_fact_basic.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">from_</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span>
            <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">class_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">kernel</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">bounds</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">step</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;backtracking&#39;</span><span class="p">,</span>
            <span class="n">report</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">keep_explored_points</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CounterfactualBasicExplanation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Roll the panellet down the valley and find an explanation.</span>

<span class="sd">    Args:</span>
<span class="sd">        from_ (&#39;np.ndarray&#39;):</span>
<span class="sd">            Starting point.</span>
<span class="sd">        threshold (float):</span>
<span class="sd">            Probability to be achieved (if path is found).</span>
<span class="sd">        class_idx (int):</span>
<span class="sd">            Class to be explained (e.g. 1 for binary classifiers).</span>
<span class="sd">        kernel (TP.Optional[&#39;np.ndarray&#39;]):</span>
<span class="sd">            Used to penalize certain dimensions when trying to move around</span>
<span class="sd">            the probability space (some dimensions may be more difficult to explain,</span>
<span class="sd">            hence don&#39;t move along them). Default is np.ones(n), meaning all dimensions</span>
<span class="sd">            can be used to move around the space (must be a value between 0 and 1).</span>
<span class="sd">        bounds (TP.Optional[&#39;np.ndarray&#39;]):</span>
<span class="sd">            Feature bound values to be used when exploring the probability space. If not</span>
<span class="sd">            specified, the ones extracted from the training data are used instead.</span>
<span class="sd">        step (TP.Optional[&#39;np.ndarray&#39;]):</span>
<span class="sd">            Step values to be used when moving around the probability space. If not specified,</span>
<span class="sd">            training bounds are divided by 200 (arbitrary value) and these are used as step value.</span>
<span class="sd">        strategy (str):</span>
<span class="sd">            If &#39;backtracking&#39;, the backtracking strategy is used to move around the probability space.</span>
<span class="sd">            If &#39;simanneal&#39;, the simulated annealing strategy is used to move around the probability space.</span>
<span class="sd">        report (bool):</span>
<span class="sd">            Whether to report the algorithm progress during the execution.</span>
<span class="sd">        keep_explored_points (bool):</span>
<span class="sd">            Whether to keep the points that the algorithm explores. Setting it to False will decrease</span>
<span class="sd">            the computation time and memory usage in some cases. Default value is True.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AssertionError:</span>
<span class="sd">            If `from_` number of dimensions is != 1 |</span>
<span class="sd">            If `from_` shape does not match `bounds` shape |</span>
<span class="sd">            If `bounds` shape is not valid |</span>
<span class="sd">            If `step` shape does not match `bounds` shape |</span>
<span class="sd">        ValueError:</span>
<span class="sd">            if strategy is not &#39;backtacking&#39; or &#39;simanneal&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        explanation (CounterfactualBasicExplanation):</span>
<span class="sd">            CounterfactualBasicExplanation with the solution found and how it differs from the starting point.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">kernel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">from_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span>

    <span class="k">assert</span> <span class="n">from_</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> \
        <span class="s1">&#39;Invalid starting point shape, got </span><span class="si">{}</span><span class="s1"> but expected unidimensional vector&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">from_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
            <span class="s1">&#39;Starting point and bounds shapes should match, got </span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Update bounds based on reference point</span>
    <span class="n">l_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">l_bounds</span><span class="p">):</span>
        <span class="n">new_min</span> <span class="o">=</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_max</span> <span class="o">=</span> <span class="n">bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">from_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">new_min</span> <span class="o">=</span> <span class="n">from_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">from_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">new_max</span> <span class="o">=</span> <span class="n">from_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">l_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_min</span>
        <span class="n">l_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_max</span>

    <span class="c1"># Update bounds, if new_bounds are specified</span>
    <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">bounds</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">l_bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> \
            <span class="s1">&#39;Invalid dimensions for new bounds, got </span><span class="si">{}</span><span class="s1"> but expected </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">l_bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bounds</span><span class="p">):</span>
            <span class="c1"># Update bound only if starting point is within it in this dimension</span>
            <span class="k">if</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">from_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">from_</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">l_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">l_bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
            <span class="s1">&#39;Invalid step shape, got </span><span class="si">{}</span><span class="s1"> but expected </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">l_bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>

    <span class="k">if</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s1">&#39;backtracking&#39;</span><span class="p">:</span>
        <span class="c1"># Backtracking strategy</span>
        <span class="n">sol</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="n">explored</span> <span class="o">=</span> <span class="n">Backtracking</span><span class="p">(</span><span class="n">from_</span><span class="p">,</span> <span class="n">l_bounds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">,</span> <span class="n">class_idx</span><span class="p">,</span>
                                                       <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">,</span>
                                                       <span class="n">keep_explored_points</span><span class="o">=</span><span class="n">keep_explored_points</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="n">visited</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">visited</span> <span class="o">=</span> <span class="n">visited</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">keep_explored_points</span><span class="p">:</span>
            <span class="n">explored_points</span> <span class="o">=</span> <span class="n">explored</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">explored_ps</span> <span class="o">=</span> <span class="n">explored</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">explored_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="n">explored_ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">return</span> <span class="n">CounterfactualBasicExplanation</span><span class="p">(</span>
            <span class="n">from_</span><span class="p">,</span> <span class="n">sol</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">l_bounds</span><span class="p">,</span> <span class="n">explored_points</span><span class="p">,</span>
            <span class="n">explored_ps</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s1">&#39;simanneal&#39;</span><span class="p">:</span>
        <span class="c1"># Simulated Annealing strategy</span>
        <span class="n">sol</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="n">energies</span> <span class="o">=</span> <span class="n">SimulatedAnnealing</span><span class="p">(</span><span class="n">from_</span><span class="p">,</span> <span class="n">l_bounds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">,</span> <span class="n">class_idx</span><span class="p">,</span>
                                                             <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">,</span>
                                                             <span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CounterfactualBasicExplanation</span><span class="p">(</span><span class="n">from_</span><span class="p">,</span> <span class="n">sol</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">visited</span><span class="p">,</span> <span class="n">energies</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">l_bounds</span><span class="p">,</span>
                                               <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid strategy&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.explainability.explainers.counter_fact_importance" class="doc doc-heading">
            <code>counter_fact_importance</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase" class="doc doc-heading">
              <code class=" language-python"><span class="n">CounterFactualExplainerBase</span><span class="p">(</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">drop_features</span><span class="o">=</span><span class="p">[])</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract base class for CounterFactual explainers which hold common
functionalities. You should extend this if you are implementing a
custom counter factual explainer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>feature_names</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of names of the features used in the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>drop_features</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List with the names, as specified in feature_names, or with the
indexes of the variables to leave out while looking for
explanations.</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
      </tbody>
    </table>






                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/counter_fact_importance.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
             <span class="n">drop_features</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span> <span class="o">=</span> <span class="n">feature_names</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drop_features</span> <span class="o">=</span> <span class="n">drop_features</span>
    <span class="c1"># Each subclass will use its internal Alibi member (CounterFactual or</span>
    <span class="c1"># CounterFactualProto)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cf_super</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase._compute_feature_range" class="doc doc-heading">
            <code class=" language-python"><span class="n">_compute_feature_range</span><span class="p">(</span><span class="n">feature_range</span><span class="p">,</span> <span class="n">drop_features</span><span class="p">,</span> <span class="n">explain_data</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>This function computes a feature range adjusted to a given observation
such that the range for the features established on argument drop_features
do not allow for change.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>feature_range</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Tuple">Tuple</span>, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple with min and max ranges to allow for perturbed instances. Min and max
ranges have to be numpy arrays with dimension (1 x nb of features)
for feature-wise ranges when dropping features.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>drop_features</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List with the indexes of the variables to leave out while looking
for explanations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>explain_data</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instance to be explained</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple containing the new feature range.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/counter_fact_importance.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_compute_feature_range</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">feature_range</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Tuple</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">drop_features</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">explain_data</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function computes a feature range adjusted to a given observation</span>
<span class="sd">    such that the range for the features established on argument drop_features</span>
<span class="sd">    do not allow for change.</span>

<span class="sd">    Args:</span>
<span class="sd">        feature_range:</span>
<span class="sd">            Tuple with min and max ranges to allow for perturbed instances. Min and max</span>
<span class="sd">            ranges have to be numpy arrays with dimension (1 x nb of features)</span>
<span class="sd">            for feature-wise ranges when dropping features.</span>
<span class="sd">        drop_features:</span>
<span class="sd">            List with the indexes of the variables to leave out while looking</span>
<span class="sd">            for explanations.</span>
<span class="sd">        explain_data:</span>
<span class="sd">            Instance to be explained</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple containing the new feature range.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">explain_data</span> <span class="o">=</span> <span class="n">explain_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">feat_range</span> <span class="o">=</span> <span class="n">feature_range</span>
    <span class="n">feat_range</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">drop_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">explain_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">drop_features</span><span class="p">]</span>
    <span class="n">feat_range</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">drop_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">explain_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">drop_features</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">feat_range</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase._regularize_counterfactual" class="doc doc-heading">
            <code class=" language-python"><span class="n">_regularize_counterfactual</span><span class="p">(</span><span class="n">predict_fn</span><span class="p">,</span> <span class="n">explain_data</span><span class="p">,</span> <span class="n">counterfactual_original</span><span class="p">,</span> <span class="n">min_prob</span><span class="p">,</span> <span class="n">threshold_incr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">init_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_iterations</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Internal function to regularize the encountered counterfactuals.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>predict_fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="pandas.DataFrame">DataFrame</span>]], <span title="typing.Union">Union</span>[float, <span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model prediction function. This function should return the probabilities of belonging to each class.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>explain_data</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Numpy array with containing the values for all features for the original instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>counterfactual_original</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Numpy array containing the resulting counterfactual computed by alibi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_prob</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target minimum probability to be reached while regularizing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold_incr</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Increments to be applied to the threshold by which each feature is reduced to zero. Defaults to 0.01.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>init_threshold</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial threshold that determines whether the feature has to be reduced to zero or not. Defaults 0.1.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_iterations</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of iterations for which the regularization process runs. Defaults to 10000.</p>
              </div>
            </td>
            <td>
                  <code>10000</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns (tuple):
        A tuple containing the new counterfactual, the difference between the new counterfactual and the original
        instance and finally, the achieved probability.</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/counter_fact_importance.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_regularize_counterfactual</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">predict_fn</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]],</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">]],</span>
    <span class="n">explain_data</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span>
    <span class="n">counterfactual_original</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span>
    <span class="n">min_prob</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">threshold_incr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">init_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TP</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal function to regularize the encountered counterfactuals.</span>

<span class="sd">    Args:</span>
<span class="sd">        predict_fn:</span>
<span class="sd">            Model prediction function. This function should return the probabilities of belonging to each class.</span>
<span class="sd">        explain_data:</span>
<span class="sd">            Numpy array with containing the values for all features for the original instance.</span>
<span class="sd">        counterfactual_original:</span>
<span class="sd">            Numpy array containing the resulting counterfactual computed by alibi.</span>
<span class="sd">        min_prob:</span>
<span class="sd">            Target minimum probability to be reached while regularizing.</span>
<span class="sd">        threshold_incr:</span>
<span class="sd">            Increments to be applied to the threshold by which each feature is reduced to zero. Defaults to 0.01.</span>
<span class="sd">        init_threshold:</span>
<span class="sd">            Initial threshold that determines whether the feature has to be reduced to zero or not. Defaults 0.1.</span>
<span class="sd">        max_iterations:</span>
<span class="sd">            Maximum number of iterations for which the regularization process runs. Defaults to 10000.</span>

<span class="sd">    Returns (tuple):</span>
<span class="sd">            A tuple containing the new counterfactual, the difference between the new counterfactual and the original</span>
<span class="sd">            instance and finally, the achieved probability.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">explain_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">counterfactual_original</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            The dimensions of the original instance (</span><span class="si">{}</span><span class="s2">) and that</span>
<span class="s2">            of the counterfactual instance (</span><span class="si">{}</span><span class="s2">) do not match</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">explain_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">counterfactual_original</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">raise</span>

    <span class="n">differences</span> <span class="o">=</span> <span class="p">(</span><span class="n">explain_data</span> <span class="o">-</span> <span class="n">counterfactual_original</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">predict_fn</span><span class="p">(</span><span class="n">counterfactual_original</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">counter_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
    <span class="n">counter_proba</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="n">counter_class</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">min_prob</span> <span class="o">&gt;=</span> <span class="n">counter_proba</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            The objective class probability is larger than that of the counterfactual passed to this method.</span>
<span class="s2">            This means that either the target probability is greater than that stablished when calling the</span>
<span class="s2">            counterfactual method or that the counterfactual being passed to this method is not well formed.</span>
<span class="s2">            The inputed target_probability was </span><span class="si">{:.3f}</span><span class="s2"> while the obtained probability for this counterfactual is </span><span class="si">{:.3f}</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_prob</span><span class="p">,</span> <span class="n">counter_proba</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">raise</span>

    <span class="n">new_proba</span> <span class="o">=</span> <span class="n">counter_proba</span>
    <span class="n">new_cfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">init_threshold</span>
    <span class="n">n_iter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">new_proba</span> <span class="o">&gt;=</span> <span class="n">min_prob</span><span class="p">:</span>
        <span class="n">new_cf</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">diff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">differences</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">new_cf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counterfactual_original</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_cf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">explain_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">new_probas_</span> <span class="o">=</span> <span class="n">predict_fn</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_cf</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_proba_</span> <span class="o">=</span> <span class="n">new_probas_</span><span class="p">[</span><span class="n">counter_class</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">new_proba_</span> <span class="o">&gt;</span> <span class="n">min_prob</span><span class="p">:</span>
            <span class="n">new_cfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_cf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_cfs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">new_cfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counterfactual_original</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">differences</span> <span class="o">=</span> <span class="p">(</span><span class="n">explain_data</span> <span class="o">-</span> <span class="n">new_cfs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">threshold</span> <span class="o">+=</span> <span class="n">threshold_incr</span>
        <span class="n">new_proba</span> <span class="o">=</span> <span class="n">new_proba_</span>
        <span class="n">n_iter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">n_iter</span> <span class="o">==</span> <span class="n">max_iterations</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No solution...&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Final threshold: &#39;</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
            <span class="k">break</span>

    <span class="n">regularized_counterfactual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_cfs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">explain_data</span> <span class="o">-</span> <span class="n">regularized_counterfactual</span>
    <span class="n">new_probability</span> <span class="o">=</span> <span class="n">predict_fn</span><span class="p">(</span><span class="n">regularized_counterfactual</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="n">counter_class</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">regularized_counterfactual</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">new_probability</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase.get_feature_importance" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_feature_importance</span><span class="p">(</span><span class="n">explain_data</span><span class="p">,</span> <span class="n">n_important_features</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">print_every</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">threshold_probability</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">threshold_incr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">init_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_iterations</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">get_report</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>This method computes the feature importance for a set of observations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>explain_data</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pandas DataFrame containing all the instances for which to find an anchor and therefore
obtain feature importances.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_important_features</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of top features that will be printed. Defaults to 3.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_every</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logging information (default=5).</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold_incr</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The increment of the threshold to be used in the regularizer so as to bring the differences
between a counterfactual instance and the original one to zero.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>init_threshold</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial and minimum value to be used in the regularizer to bring the differences
between a counterfactual instance and the original one to zero.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_iterations</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of iterations for the regularizer. This parameter gets pass
down to the regularize_counterfactual method.</p>
              </div>
            </td>
            <td>
                  <code>10000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>get_report</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean determining whether to print the explanation or not.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="mercury.explainability.explanations.counter_factual.CounterfactualWithImportanceExplanation" href="../explanations/#mercury.explainability.explanations.counter_factual.CounterfactualWithImportanceExplanation">CounterfactualWithImportanceExplanation</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A CounterfactualExtendedExplanation object that contains all explanations as well as</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="mercury.explainability.explanations.counter_factual.CounterfactualWithImportanceExplanation" href="../explanations/#mercury.explainability.explanations.counter_factual.CounterfactualWithImportanceExplanation">CounterfactualWithImportanceExplanation</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>their interpretation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/counter_fact_importance.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_feature_importance</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">explain_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">n_important_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">print_every</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">threshold_probability</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">threshold_incr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">init_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="n">get_report</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CounterfactualWithImportanceExplanation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method computes the feature importance for a set of observations.</span>

<span class="sd">    Args:</span>
<span class="sd">        explain_data:</span>
<span class="sd">            Pandas DataFrame containing all the instances for which to find an anchor and therefore</span>
<span class="sd">            obtain feature importances.</span>
<span class="sd">        n_important_features:</span>
<span class="sd">            Number of top features that will be printed. Defaults to 3.</span>
<span class="sd">        print_every:</span>
<span class="sd">            Logging information (default=5).</span>
<span class="sd">        threshold_incr:</span>
<span class="sd">            The increment of the threshold to be used in the regularizer so as to bring the differences</span>
<span class="sd">            between a counterfactual instance and the original one to zero.</span>
<span class="sd">        init_threshold:</span>
<span class="sd">            The initial and minimum value to be used in the regularizer to bring the differences</span>
<span class="sd">            between a counterfactual instance and the original one to zero.</span>
<span class="sd">        max_iterations:</span>
<span class="sd">            Maximum number of iterations for the regularizer. This parameter gets pass</span>
<span class="sd">            down to the regularize_counterfactual method.</span>
<span class="sd">        get_report:</span>
<span class="sd">            Boolean determining whether to print the explanation or not.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A CounterfactualExtendedExplanation object that contains all explanations as well as</span>
<span class="sd">        their interpretation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">failed_explanations</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">counterfactuals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">attempted_explanations</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">item_idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">explain_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">attempted_explanations</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">cf_explanation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span>
                <span class="n">item</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">cf_regularized</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">new_proba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regularize_counterfactual</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predict_fn</span><span class="p">,</span>
                <span class="n">item</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">cf_explanation</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;cf&#39;</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                <span class="n">min_prob</span><span class="o">=</span><span class="n">threshold_probability</span><span class="p">,</span>
                <span class="n">threshold_incr</span><span class="o">=</span><span class="n">threshold_incr</span><span class="p">,</span>
                <span class="n">max_iterations</span><span class="o">=</span><span class="n">max_iterations</span><span class="p">,</span>
                <span class="n">init_threshold</span><span class="o">=</span><span class="n">init_threshold</span>
            <span class="p">)</span>
            <span class="n">cf_explanation</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;cf_original&#39;</span><span class="p">:</span> <span class="n">cf_explanation</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;cf&#39;</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                <span class="s1">&#39;cf_class&#39;</span><span class="p">:</span> <span class="n">cf_explanation</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;cf&#39;</span><span class="p">][</span><span class="s1">&#39;class&#39;</span><span class="p">],</span>
                <span class="s1">&#39;cf_proba&#39;</span><span class="p">:</span> <span class="n">cf_explanation</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;cf&#39;</span><span class="p">][</span><span class="s1">&#39;proba&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span>
                    <span class="n">cf_explanation</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;cf&#39;</span><span class="p">][</span><span class="s1">&#39;class&#39;</span><span class="p">]</span>
                <span class="p">],</span>
                <span class="s1">&#39;cf_regularized&#39;</span><span class="p">:</span> <span class="n">cf_regularized</span><span class="p">,</span>
                <span class="s1">&#39;cf_reg_proba&#39;</span><span class="p">:</span> <span class="n">new_proba</span><span class="p">,</span>
                <span class="s1">&#39;diff_orig_reg&#39;</span><span class="p">:</span> <span class="n">diff</span>
            <span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">failed_explanations</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            There&#39;s been a problem while computing the explanation for observation: </span><span class="si">{}</span><span class="s1">.</span>
<span class="s1">            If this observation is critical to you try with some other hyperparameters.</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item_idx</span><span class="p">))</span>
            <span class="n">cf_explanation</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;cf_original&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;cf_class&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;cf_proba&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;cf_regularized&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;cf_reg_proba&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;diff_orig_reg&#39;</span><span class="p">:</span> <span class="kc">None</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="n">attempted_explanations</span> <span class="o">%</span> <span class="n">print_every</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> counterfactuals already computed. Found a solution for </span><span class="si">{}</span><span class="s1"> of them&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">attempted_explanations</span><span class="p">,</span> <span class="n">attempted_explanations</span> <span class="o">-</span> <span class="n">failed_explanations</span>
            <span class="p">))</span>
        <span class="n">counterfactuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cf_explanation</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All counterfactuals have been computed and regularized&#39;</span><span class="p">)</span>

    <span class="n">count_differences</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">feat_name</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">feat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span>
    <span class="p">)</span>
    <span class="n">total_diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">counterfactuals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">counterfactual_i</span> <span class="ow">in</span> <span class="n">counterfactuals</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">counterfactual_i</span><span class="p">[</span><span class="s1">&#39;cf_original&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">total_diffs</span> <span class="o">+=</span> <span class="n">counterfactual_i</span><span class="p">[</span><span class="s1">&#39;diff_orig_reg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">diffs_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">counterfactual_i</span><span class="p">[</span><span class="s1">&#39;diff_orig_reg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">diffs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">count_differences</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">max_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">total_diffs</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">total_diffs</span> <span class="o">/=</span> <span class="n">max_diff</span>

    <span class="n">importances</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">name</span>
        <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">total_diffs</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">total_diffs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">),</span>
            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="p">]</span>

    <span class="n">count_differences_norm</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">/</span> <span class="p">(</span><span class="n">explain_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">failed_explanations</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span>
        <span class="ow">in</span> <span class="n">count_differences</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">count_differences_norm</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span>
        <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">count_differences_norm</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="n">n_important_features</span> <span class="o">=</span> <span class="n">n_important_features</span> <span class="k">if</span> <span class="n">n_important_features</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>

    <span class="n">counterfactualExtendedExplanation</span> <span class="o">=</span> <span class="n">CounterfactualWithImportanceExplanation</span><span class="p">(</span>
        <span class="n">explain_data</span><span class="p">,</span>
        <span class="n">counterfactuals</span><span class="p">,</span>
        <span class="n">importances</span><span class="p">,</span>
        <span class="n">count_differences</span><span class="p">,</span>
        <span class="n">count_differences_norm</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">get_report</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n_important_features</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The total number of important features was too large and therefore all will be shown&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">failed_explanations</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There were a total of </span><span class="si">{:d}</span><span class="s1"> fails&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">failed_explanations</span><span class="p">))</span>
        <span class="n">counterfactualExtendedExplanation</span><span class="o">.</span><span class="n">interpret_explanations</span><span class="p">(</span>
            <span class="n">n_important_features</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">counterfactualExtendedExplanation</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.counter_fact_importance.CounterfactualExplainer" class="doc doc-heading">
              <code class=" language-python"><span class="n">CounterfactualExplainer</span><span class="p">(</span><span class="n">predict_fn</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drop_features</span><span class="o">=</span><span class="p">[],</span> <span class="n">distance_fn</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">target_proba</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">target_class</span><span class="o">=</span><span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">early_stop</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">lam_init</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_lam_steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">learning_rate_init</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">10000000000.0</span><span class="p">,</span> <span class="mf">10000000000.0</span><span class="p">),</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="s1">&#39;identity&#39;</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">write_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sess</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase" href="#mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase">CounterFactualExplainerBase</a></code></p>


        <p>Backed by Alibi's CounterFactual, this class extends its functionality to allow for the computation of Feature
Importances by means of the computation of several Counterfactuals.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>predict_fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="pandas.DataFrame">DataFrame</span>]], <span title="typing.Union">Union</span>[float, <span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model prediction function. This function should return the probabilities of belonging to each class.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feature_names</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of names of the features used in the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shape</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape of input data starting with batch size. By default it is inferred from feature_names.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>drop_features</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List with the names, as specified in feature_names, or with the indexes of the variables to leave
out while looking for explanations (in get_feature_importance method).</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>distance_fn</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Distance function to use in the loss term</p>
              </div>
            </td>
            <td>
                  <code>&#39;l1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_proba</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target probability for the counterfactual to reach</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_class</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target class for the counterfactual to reach, one of 'other', 'same' or an integer denoting
desired class membership for the counterfactual instance</p>
              </div>
            </td>
            <td>
                  <code>&#39;other&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_iter</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of interations to run the gradient descent for (inner loop)</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>early_stop</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of steps after which to terminate gradient descent if all or none of found instances are solutions</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lam_init</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial regularization constant for the prediction part of the Wachter loss</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_lam_steps</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of times to adjust the regularization constant (outer loop) before terminating the search</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tol</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tolerance for the counterfactual target probability</p>
              </div>
            </td>
            <td>
                  <code>0.05</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>learning_rate_init</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial learning rate for each outer loop of lambda</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feature_range</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Tuple">Tuple</span>[<span title="typing.Any">Any</span>], str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple with min and max ranges to allow for perturbed instances. Min and max ranges can be floats or
numpy arrays with dimension (1 x nb of features) for feature-wise ranges</p>
              </div>
            </td>
            <td>
                  <code>(-10000000000.0, 10000000000.0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[float, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Gradient step sizes used in calculating numerical gradients, defaults to a single value for all
features, but can be passed an array for feature-wise step sizes</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>init</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initialization method for the search of counterfactuals, currently must be 'identity'</p>
              </div>
            </td>
            <td>
                  <code>&#39;identity&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decay</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to decay learning rate to zero for each outer loop over lambda</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>write_dir</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to write Tensorboard files to</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to write Tensorboard summaries for debugging</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sess</code>
            </td>
            <td>
                  <code><span title="tensorflow.compat.v1.Session">Session</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional Tensorflow session that will be used if passed instead of creating or inferring one internally</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>






                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/counter_fact_importance.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">predict_fn</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]],</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">]],</span>
    <span class="n">feature_names</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">shape</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">drop_features</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">distance_fn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;l1&#39;</span><span class="p">,</span>
    <span class="n">target_proba</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">target_class</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">early_stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">lam_init</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-1</span><span class="p">,</span>
    <span class="n">max_lam_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">learning_rate_init</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">feature_range</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1e10</span><span class="p">,</span> <span class="mf">1e10</span><span class="p">),</span>
    <span class="n">eps</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">init</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;identity&#39;</span><span class="p">,</span>
    <span class="n">decay</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">write_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">sess</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">Session</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">CounterfactualExplainer</span><span class="p">,</span>
          <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">drop_features</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">predict_fn</span> <span class="o">=</span> <span class="n">predict_fn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span> <span class="k">if</span> <span class="n">shape</span> <span class="k">else</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_names</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">distance_fn</span> <span class="o">=</span> <span class="n">distance_fn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_proba</span> <span class="o">=</span> <span class="n">target_proba</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_class</span> <span class="o">=</span> <span class="n">target_class</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="n">max_iter</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">early_stop</span> <span class="o">=</span> <span class="n">early_stop</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lam_init</span> <span class="o">=</span> <span class="n">lam_init</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_lam_steps</span> <span class="o">=</span> <span class="n">max_lam_steps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate_init</span> <span class="o">=</span> <span class="n">learning_rate_init</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_range</span> <span class="o">=</span> <span class="n">feature_range</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decay</span> <span class="o">=</span> <span class="n">decay</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_dir</span> <span class="o">=</span> <span class="n">write_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sess</span> <span class="o">=</span> <span class="n">sess</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cat_vars</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Instantiate counterfactual</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cf_super</span> <span class="o">=</span> <span class="n">CounterFactual</span><span class="p">(</span>
        <span class="n">predict_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_fn</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
        <span class="n">distance_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">distance_fn</span><span class="p">,</span> <span class="n">target_proba</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_proba</span><span class="p">,</span>
        <span class="n">target_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_class</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span><span class="p">,</span>
        <span class="n">early_stop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">early_stop</span><span class="p">,</span> <span class="n">lam_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_init</span><span class="p">,</span>
        <span class="n">max_lam_steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_lam_steps</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">,</span>
        <span class="n">learning_rate_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">learning_rate_init</span><span class="p">,</span>
        <span class="n">feature_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_range</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span>
        <span class="n">init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">,</span> <span class="n">write_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">write_dir</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="n">sess</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.counter_fact_importance.CounterfactualExplainer.explain" class="doc doc-heading">
            <code class=" language-python"><span class="n">explain</span><span class="p">(</span><span class="n">explain_data</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>This method serves two purposes. Firstly as an interface between the user and the CounterFactual class
explain method and secondly, if there are features that shouldn't be taken into account, the method
recomputes feature_range to account for this and reinstantiates the parent class (CounterFactual).
Explain an instance and return the counterfactual with metadata.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>explain_data</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instance to be explained</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="alibi.api.interfaces.Explanation">Explanation</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Explanation object as specified in Alibi's original explain method.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/counter_fact_importance.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">explain_data</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Explanation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method serves two purposes. Firstly as an interface between the user and the CounterFactual class</span>
<span class="sd">    explain method and secondly, if there are features that shouldn&#39;t be taken into account, the method</span>
<span class="sd">    recomputes feature_range to account for this and reinstantiates the parent class (CounterFactual).</span>
<span class="sd">    Explain an instance and return the counterfactual with metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">        explain_data (np.ndarray): Instance to be explained</span>

<span class="sd">    Returns:</span>
<span class="sd">        Explanation object as specified in Alibi&#39;s original explain method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf_super</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span>
        <span class="n">explain_data</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.counter_fact_importance.CounterfactualProtoExplainer" class="doc doc-heading">
              <code class=" language-python"><span class="n">CounterfactualProtoExplainer</span><span class="p">(</span><span class="n">predict_fn</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drop_features</span><span class="o">=</span><span class="p">[],</span> <span class="n">kappa</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">feature_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ae_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enc_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">cat_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ohe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_kdtree</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">learning_rate_init</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">max_iterations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">c_init</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">c_steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">),</span> <span class="n">clip</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">update_num_grad</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">write_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trustscore_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d_type</span><span class="o">=</span><span class="s1">&#39;abdm&#39;</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">disc_perc</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">],</span> <span class="n">standardize_cat_vars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">update_feature_range</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase" href="#mercury.explainability.explainers.counter_fact_importance.CounterFactualExplainerBase">CounterFactualExplainerBase</a></code></p>


        <p>Backed by Alibi's CounterFactualProto, this class extends its functionality to allow for the computation of Feature
Importances by means of the computation of several Counterfactuals.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>predict_fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="pandas.DataFrame">DataFrame</span>]], <span title="typing.Union">Union</span>[float, <span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model prediction function. This function should return the probabilities of belonging to
each class.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_data</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="pandas.DataFrame">DataFrame</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Numpy array or Pandas dataframe with the training examples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feature_names</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of names of the features used in the model. Will be inferred by default from train_data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shape</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape of input data starting with batch size. Will be inferred by default from train_data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>drop_features</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List with the names, as specified in feature_names, or with the indexes of the variables to leave
out while looking for explanations.</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beta</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Regularization constant for L1 loss term</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Confidence parameter for the attack loss term</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feature_range</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Tuple">Tuple</span>[<span title="typing.Any">Any</span>], str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple with min and max ranges to allow for perturbed instances. Min and max ranges can be floats or
numpy arrays with dimension (1x nb of features) for feature-wise ranges.
Will be inferred by default from train_data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gamma</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Regularization constant for optional auto-encoder loss term</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ae_model</code>
            </td>
            <td>
                  <code><span title="tensorflow.keras.Model">Model</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional auto-encoder model used for loss regularization</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>enc_model</code>
            </td>
            <td>
                  <code><span title="tensorflow.keras.Model">Model</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional encoder model used to guide instance perturbations towards a class prototype</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>theta</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Constant for the prototype search loss term. Default is 5. Set it to zero to disable it.</p>
              </div>
            </td>
            <td>
                  <code>5.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cat_vars</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict with as keys the categorical columns and as values
the number of categories per categorical variable.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ohe</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the categorical variables are one-hot encoded (OHE) or not. If not OHE, they are
assumed to have ordinal encodings.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_kdtree</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use k-d trees for the prototype loss term if no encoder is available</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>learning_rate_init</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial learning rate of optimizer</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_iterations</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of iterations for finding a counterfactual</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>c_init</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial value to scale the attack loss term. If the computation shall be fastened up, this
parameter should take a small value (0 or 1).</p>
              </div>
            </td>
            <td>
                  <code>10.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>c_steps</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of iterations to adjust the constant scaling the attack loss term. If the computation
shall be fastened up this parameter should take a somewhat small value (between 1 and 5).</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[float, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If numerical gradients are used to compute dL/dx = (dL/dp) * (dp/dx), then eps[0] is used to
calculate dL/dp and eps[1] is used for dp/dx. eps[0] and eps[1] can be a combination of float values and
numpy arrays. For eps[0], the array dimension should be (1x nb of prediction categories) and for
eps[1] it should be (1x nb of features)</p>
              </div>
            </td>
            <td>
                  <code>(0.001, 0.001)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>clip</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple with min and max clip ranges for both the numerical gradients and the gradients
obtained from the TensorFlow graph</p>
              </div>
            </td>
            <td>
                  <code>(-1000, 1000)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>update_num_grad</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If numerical gradients are used, they will be updated every update_num_grad iterations. If
the computation shall be fastened up this parameter should take a somewhat large value
(between 100 and 250).</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>update_num_grad</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If numerical gradients are used, they will be updated every update_num_grad iterations</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>write_dir</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to write tensorboard files to</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sess</code>
            </td>
            <td>
                  <code><span title="tensorflow.compat.v1.Session">Session</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional Tensorflow session that will be used if passed instead of creating or inferring one internally</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trustscore_kwargs</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments for the trust score object used to define the k-d trees for each class.
(See original alibi) counterfactual guided by prototypes docs.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>d_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Distance metric. Options are "abdm", "mvdm" or "abdm-mvdm".</p>
              </div>
            </td>
            <td>
                  <code>&#39;abdm&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the combined metric "abdm-mvdm" is used, w is the weight (between 0 and 1) given to abdm.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>disc_perc</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[<span title="typing.Union">Union</span>[int, float]], <span title="typing.Tuple">Tuple</span>[<span title="typing.Union">Union</span>[int, float]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List with percentiles (int) used for discretization</p>
              </div>
            </td>
            <td>
                  <code>[25, 50, 75]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>standardize_cat_vars</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return the standardized values for the numerical distances of each categorical feature.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smooth</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if the difference in the distances between the categorical variables is too large, then a lower
value of the smooth argument (0, 1) can smoothen out this difference. This would only be relevant
if one categorical variable has significantly larger differences between its categories than others.
As a result, the counterfactual search process will likely leave that categorical variable unchanged.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>center</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to center the numerical distances of the categorical variables between the min and max feature ranges.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>update_feature_range</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to update the feature_range parameter for the categorical variables based on the min and max values
it computed in the constructor.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>






                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/counter_fact_importance.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">predict_fn</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]],</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">]],</span>
    <span class="n">train_data</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
    <span class="n">feature_names</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">shape</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">drop_features</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">kappa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span>
    <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">.1</span><span class="p">,</span>
    <span class="n">feature_range</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span>
    <span class="n">ae_model</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">enc_model</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
    <span class="n">cat_vars</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ohe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_kdtree</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">learning_rate_init</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">,</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">c_init</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">,</span>
    <span class="n">c_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">eps</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;np.ndarray&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">),</span>
    <span class="n">clip</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
    <span class="n">update_num_grad</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">write_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sess</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">Session</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">trustscore_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">d_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;abdm&#39;</span><span class="p">,</span>
    <span class="n">w</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">disc_perc</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">TP</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">],</span>
    <span class="n">standardize_cat_vars</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">smooth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span>
    <span class="n">center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">update_feature_range</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">feature_names</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If feature_names is not present, train_data&quot;</span> <span class="o">+</span>
                         <span class="s2">&quot;should be a Pandas DataFrame. &quot;</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">CounterfactualProtoExplainer</span><span class="p">,</span>
          <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">drop_features</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_range</span> <span class="o">=</span> <span class="n">feature_range</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predict_fn</span> <span class="o">=</span> <span class="n">predict_fn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span> <span class="o">=</span> <span class="n">feature_names</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">=</span> <span class="n">kappa</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ae_model</span> <span class="o">=</span> <span class="n">ae_model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">enc_model</span> <span class="o">=</span> <span class="n">enc_model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cat_vars</span> <span class="o">=</span> <span class="n">cat_vars</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ohe</span> <span class="o">=</span> <span class="n">ohe</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">use_kdtree</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">enc_model</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ae_model</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate_init</span> <span class="o">=</span> <span class="n">learning_rate_init</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_iterations</span> <span class="o">=</span> <span class="n">max_iterations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">c_init</span> <span class="o">=</span> <span class="n">c_init</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">c_steps</span> <span class="o">=</span> <span class="n">c_steps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clip</span> <span class="o">=</span> <span class="n">clip</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_num_grad</span> <span class="o">=</span> <span class="n">update_num_grad</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_dir</span> <span class="o">=</span> <span class="n">write_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sess</span> <span class="o">=</span> <span class="n">sess</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span> <span class="o">=</span> <span class="n">train_data</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_range</span> <span class="o">=</span> \
            <span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">train_data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> \
                <span class="k">if</span> <span class="ow">not</span> <span class="n">feature_range</span> <span class="k">else</span> <span class="p">(</span><span class="o">-</span><span class="mf">2e5</span><span class="p">,</span> <span class="mf">2e5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">=</span><span class="n">train_data</span><span class="o">.</span><span class="n">values</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cf_super</span> <span class="o">=</span> <span class="n">CounterFactualProto</span><span class="p">(</span>
        <span class="n">predict</span><span class="o">=</span><span class="n">predict_fn</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span>
        <span class="n">feature_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_range</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span> <span class="n">ae_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ae_model</span><span class="p">,</span>
        <span class="n">enc_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">enc_model</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">cat_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_vars</span><span class="p">,</span> <span class="n">ohe</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ohe</span><span class="p">,</span>
        <span class="n">use_kdtree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_kdtree</span><span class="p">,</span> <span class="n">learning_rate_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">learning_rate_init</span><span class="p">,</span>
        <span class="n">max_iterations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_iterations</span><span class="p">,</span> <span class="n">c_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">c_init</span><span class="p">,</span> <span class="n">c_steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">c_steps</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clip</span><span class="p">,</span> <span class="n">update_num_grad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update_num_grad</span><span class="p">,</span>
        <span class="n">write_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">write_dir</span><span class="p">,</span> <span class="n">sess</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sess</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cf_super</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf_super</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="p">,</span> <span class="n">trustscore_kwargs</span><span class="o">=</span><span class="n">trustscore_kwargs</span><span class="p">,</span> <span class="n">d_type</span><span class="o">=</span><span class="n">d_type</span><span class="p">,</span>
        <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">disc_perc</span><span class="o">=</span><span class="n">disc_perc</span><span class="p">,</span> <span class="n">standardize_cat_vars</span><span class="o">=</span><span class="n">standardize_cat_vars</span><span class="p">,</span>
        <span class="n">smooth</span><span class="o">=</span><span class="n">smooth</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span> <span class="n">update_feature_range</span><span class="o">=</span><span class="n">update_feature_range</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.counter_fact_importance.CounterfactualProtoExplainer.explain" class="doc doc-heading">
            <code class=" language-python"><span class="n">explain</span><span class="p">(</span><span class="n">explain_data</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">k_type</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">print_every</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">log_every</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>This method serves three purposes. Firstly as an interface between the user and the CounterFactualProto
class explain method, secondly, if there are features that shouldn't be taken into account, the method
recomputes feature_range to account for this and reinstantiates the parent class (CounterFactualProto)
and thridly, if a new CounterFactualProto instance has been created it's fitted.
Explain instance and return counterfactual with metadata.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>explain_data</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instances to explain</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Y</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Labels for X as one-hot-encoding</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_class</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List with target classes used to find closest prototype. If None, the nearest prototype
except for the predict class on the instance is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nearest instances used to define the prototype for a class. Defaults to using all
instances belonging to the class if an encoder is used and to 1 for k-d trees.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Use either the average encoding of the k nearest instances in a class (k_type='mean') or
the k-nearest encoding in the class (k_type='point') to define the prototype of that class.
Only relevant if an encoder is used to define the prototypes.</p>
              </div>
            </td>
            <td>
                  <code>&#39;mean&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Threshold level for the ratio between the distance of the counterfactual to the prototype of the
predicted class for the original instance over the distance to the prototype of the predicted class
for the counterfactual. If the trust score is below the threshold, the proposed counterfactual does
not meet the requirements.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Print intermediate results of optimization if True</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_every</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Print frequency if verbose is True</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>log_every</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tensorboard log frequency if write directory is specified</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="alibi.api.interfaces.Explanation">Explanation</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>explanation, Dictionary containing the counterfactual with additional metadata</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/counter_fact_importance.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">explain</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">explain_data</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span>
    <span class="n">Y</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_class</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">k_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">print_every</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">log_every</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Explanation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method serves three purposes. Firstly as an interface between the user and the CounterFactualProto</span>
<span class="sd">    class explain method, secondly, if there are features that shouldn&#39;t be taken into account, the method</span>
<span class="sd">    recomputes feature_range to account for this and reinstantiates the parent class (CounterFactualProto)</span>
<span class="sd">    and thridly, if a new CounterFactualProto instance has been created it&#39;s fitted.</span>
<span class="sd">    Explain instance and return counterfactual with metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">        explain_data:</span>
<span class="sd">            Instances to explain</span>
<span class="sd">        Y:</span>
<span class="sd">            Labels for X as one-hot-encoding</span>
<span class="sd">        target_class:</span>
<span class="sd">            List with target classes used to find closest prototype. If None, the nearest prototype</span>
<span class="sd">            except for the predict class on the instance is used.</span>
<span class="sd">        k:</span>
<span class="sd">            Number of nearest instances used to define the prototype for a class. Defaults to using all</span>
<span class="sd">            instances belonging to the class if an encoder is used and to 1 for k-d trees.</span>
<span class="sd">        k_type:</span>
<span class="sd">            Use either the average encoding of the k nearest instances in a class (k_type=&#39;mean&#39;) or</span>
<span class="sd">            the k-nearest encoding in the class (k_type=&#39;point&#39;) to define the prototype of that class.</span>
<span class="sd">            Only relevant if an encoder is used to define the prototypes.</span>
<span class="sd">        threshold:</span>
<span class="sd">            Threshold level for the ratio between the distance of the counterfactual to the prototype of the</span>
<span class="sd">            predicted class for the original instance over the distance to the prototype of the predicted class</span>
<span class="sd">            for the counterfactual. If the trust score is below the threshold, the proposed counterfactual does</span>
<span class="sd">            not meet the requirements.</span>
<span class="sd">        verbose:</span>
<span class="sd">            Print intermediate results of optimization if True</span>
<span class="sd">        print_every:</span>
<span class="sd">            Print frequency if verbose is True</span>
<span class="sd">        log_every:</span>
<span class="sd">            Tensorboard log frequency if write directory is specified</span>

<span class="sd">    Returns:</span>
<span class="sd">        explanation, Dictionary containing the counterfactual with additional metadata</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf_super</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span>
        <span class="n">explain_data</span><span class="p">,</span>
        <span class="n">Y</span><span class="p">,</span>
        <span class="n">target_class</span><span class="p">,</span>
        <span class="n">k</span><span class="p">,</span>
        <span class="n">k_type</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">,</span>
        <span class="n">print_every</span><span class="p">,</span>
        <span class="n">log_every</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.explainability.explainers.explainer" class="doc doc-heading">
            <code>explainer</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.explainer.MercuryExplainer" class="doc doc-heading">
            <code>MercuryExplainer</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>










  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.explainer.MercuryExplainer.load" class="doc doc-heading">
            <code class=" language-python"><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;explainer.pkl&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Loads a previosly saved explainer with its internal state to a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path where the explainer is stored</p>
              </div>
            </td>
            <td>
                  <code>&#39;explainer.pkl&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/explainer.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;explainer.pkl&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads a previosly saved explainer with its internal state to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): Path where the explainer is stored</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s2">&quot;File does not exist or not a valid file&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dill</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.explainer.MercuryExplainer.save" class="doc doc-heading">
            <code class=" language-python"><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;explainer.pkl&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Saves the explainer with its internal state to a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path where the explainer will be saved</p>
              </div>
            </td>
            <td>
                  <code>&#39;explainer.pkl&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/explainer.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;explainer.pkl&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves the explainer with its internal state to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): Path where the explainer will be saved</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s2">&quot;Error storing file&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.explainability.explainers.partial_dependence" class="doc doc-heading">
            <code>partial_dependence</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer" class="doc doc-heading">
              <code class=" language-python"><span class="n">PartialDependenceExplainer</span><span class="p">(</span><span class="n">predict_fn</span><span class="p">,</span> <span class="n">output_col</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span> <span class="n">max_categorical_thresh</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">quantiles</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="mercury.explainability.explainers.explainer.MercuryExplainer" href="#mercury.explainability.explainers.explainer.MercuryExplainer">MercuryExplainer</a></code></p>


        <p>This explainer will calculate the partial dependences for a ML model.
Also contains a distributed (pyspark) implementation which
allows PySpark transformers/pipelines to be explained via PD.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>predict_fn</code>
            </td>
            <td>
                  <code>Callable</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Inference function. This function will take a DataFrame (Pandas
or PySpark) and must return the output of your estimator (usually a NumPy array
for a 'plain' python model or a DataFrame in case of PySpark).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_col</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the output column name  of the PySpark transformer model.
This will only be used in case the passed explain data is of type
pyspark.DataFrame</p>
              </div>
            </td>
            <td>
                  <code>&#39;prediction&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_categorical_thresh</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If a column contains less unique values than this threshold, it will be
auto-considered categorical.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quantiles</code>
            </td>
            <td>
                  <code>float or tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Calculate the quantiles of the model predictions. If type==float,
(quantiles, 1-quantiles) range will be calculated. If type==tuple, range
will be <code>quantiles</code>. If None, the quantile calculation will be disabled
(useful for saving time).</p>
              </div>
            </td>
            <td>
                  <code>0.05</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resolution</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of different values to test for each non-categorical variable. Lowering this
value will increase speed but reduce resolution in the plots.</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Print progress status. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="c1"># &quot;Plain python&quot; example</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">features</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">FEATURE_NAMES</span><span class="p">]</span> <span class="c1"># DataFrame with only features</span>
<span class="c1"># You can create a custom inference function.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span><span class="w"> </span><span class="nf">my_inference_fn</span><span class="p">(</span><span class="n">feats</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">my_fitted_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">feats</span><span class="p">)</span>
<span class="c1"># You can also pass anything as long as it is callable and receives the predictors (e.g. my_fitted_model.predict / predict_proba).</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explainer</span> <span class="o">=</span> <span class="n">PartialDependenceExplainer</span><span class="p">(</span><span class="n">my_fitted_model</span><span class="o">.</span><span class="n">predict</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explanation</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="c1"># Plot a summary of partial dependences for all the features.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explanation</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># Plot the partial dependence of a single variable.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explanation</span><span class="o">.</span><span class="n">plot_single</span><span class="p">(</span><span class="s1">&#39;FEATURE_1&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="c1"># Pyspark Example</span>
<span class="c1"># Dataset with ONLY feature columns. (Assumed an already trained model)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">features</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">)</span>
<span class="c1"># Inference function</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span><span class="w"> </span><span class="nf">my_pred_fn</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">temp_df</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">my_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">temp_df</span><span class="p">)</span>
<span class="c1"># We can tell the explainer not to calculate  partial dependences for certain features. This will save time.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">features_to_ignore</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FEATURE_4&#39;</span><span class="p">,</span> <span class="s1">&#39;FEATURE_88&#39;</span><span class="p">]</span>
<span class="c1"># We pass our custom inference function and also, tell the explainer which column will hold the transformer&#39;s output (necessary only when explaining pyspark models).</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explainer</span> <span class="o">=</span> <span class="n">PartialDependenceExplainer</span><span class="p">(</span><span class="n">my_pred_fn</span><span class="p">,</span> <span class="n">output_col</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
<span class="c1"># Explain the model ignoring features.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explanation</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">ignore_feats</span><span class="o">=</span><span class="n">features_to_ignore</span><span class="p">)</span>
</code></pre></div>
</details>





                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/partial_dependence.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">predict_fn</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;pandas.DataFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;pyspark.sql.DataFrame&quot;</span><span class="p">]],</span>  <span class="c1"># noqa: F821</span>
                             <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot;pyspark.sql.DataFrame&quot;</span><span class="p">]],</span>  <span class="c1"># noqa: F821</span>
        <span class="n">output_col</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;prediction&#39;</span><span class="p">,</span>
        <span class="n">max_categorical_thresh</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">quantiles</span><span class="p">:</span><span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span> <span class="p">,</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predict_fn</span> <span class="o">=</span> <span class="n">predict_fn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_col</span> <span class="o">=</span> <span class="n">output_col</span>
    <span class="c1"># If the number of different values of a given feature is less</span>
    <span class="c1"># than this, we will treat it as categorical</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_max_categorical_values</span> <span class="o">=</span> <span class="n">max_categorical_thresh</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">quantiles</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_quantiles</span> <span class="o">=</span> <span class="p">(</span><span class="n">quantiles</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">quantiles</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_quantiles</span> <span class="o">=</span> <span class="n">quantiles</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.__base_impl" class="doc doc-heading">
            <code class=" language-python"><span class="n">__base_impl</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">feat_names</span><span class="p">,</span> <span class="n">categoricals</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Contains the logic for the base implementation, i.e. the  one
which uses np.ndarrays/pd.DataFrames and undistributed models.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pandas.DataFrame with ONLY the predictors.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feat_names</code>
            </td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List containing the names of the features that will be explained</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>categoricals</code>
            </td>
            <td>
                  <code>set[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set with the feature names that will be forced to be categorical.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with the partial dependences of each selected feature</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>and whether that feature is categorical or not.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/partial_dependence.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__base_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">feat_names</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">categoricals</span><span class="p">:</span><span class="nb">set</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Contains the logic for the base implementation, i.e. the  one</span>
<span class="sd">    which uses np.ndarrays/pd.DataFrames and undistributed models.</span>

<span class="sd">    Args:</span>
<span class="sd">        features (pd.DataFrame): pandas.DataFrame with ONLY the predictors.</span>
<span class="sd">        feat_names (list[str]):</span>
<span class="sd">            List containing the names of the features that will be explained</span>
<span class="sd">        categoricals (set[str]):</span>
<span class="sd">            Set with the feature names that will be forced to be categorical.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with the partial dependences of each selected feature</span>
<span class="sd">        and whether that feature is categorical or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">feat_names</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">uniques</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">nb_uniques</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniques</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">categoricals</span><span class="p">:</span>
            <span class="n">is_categorical</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_categorical</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_categorical</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">and</span> <span class="n">nb_uniques</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_categorical_values</span><span class="p">:</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">features</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_categorical</span> <span class="ow">and</span> <span class="n">nb_uniques</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_categorical_values</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">step_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">features</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">features</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">))</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">features</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">step</span><span class="o">=</span><span class="n">step_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_categorical</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">uniques</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">type_msg</span> <span class="o">=</span> <span class="s1">&#39;categorical&#39;</span> <span class="k">if</span> <span class="n">is_categorical</span> <span class="k">else</span> <span class="s1">&#39;continuous&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting calculation for feature </span><span class="si">{</span><span class="n">colname</span><span class="si">}</span><span class="s2"> - Type: </span><span class="si">{</span><span class="n">type_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_categorical</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Values to test: </span><span class="si">{</span><span class="n">grid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Value range to test: [</span><span class="si">{</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">] (only on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="si">}</span><span class="s2"> items)&quot;</span><span class="p">)</span>

        <span class="n">data</span><span class="p">[</span><span class="n">colname</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span>
        <span class="n">pdep_means</span><span class="p">,</span> <span class="n">pdep_lquant</span><span class="p">,</span> <span class="n">pdep_uquant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__partial_dep_base</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="n">colname</span><span class="p">][</span><span class="s1">&#39;preds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdep_means</span>
        <span class="n">data</span><span class="p">[</span><span class="n">colname</span><span class="p">][</span><span class="s1">&#39;lower_quantile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdep_lquant</span>
        <span class="n">data</span><span class="p">[</span><span class="n">colname</span><span class="p">][</span><span class="s1">&#39;upper_quantile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdep_uquant</span>
        <span class="n">data</span><span class="p">[</span><span class="n">colname</span><span class="p">][</span><span class="s1">&#39;categorical&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_categorical</span>

        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Partial dependence for feature </span><span class="si">{</span><span class="n">colname</span><span class="si">}</span><span class="s2"> calculated. Took </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.__partial_dep_base" class="doc doc-heading">
            <code class=" language-python"><span class="n">__partial_dep_base</span><span class="p">(</span><span class="n">feat_name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Logic for computing the partial dependence of one feature for the base
implementation (undistributed models)</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/partial_dependence.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__partial_dep_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">feat_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="s2">&quot;pandas.DataFrame&quot;</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
        <span class="n">grid</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="s2">&quot;np.array&quot;</span><span class="p">])</span><span class="o">-&gt;</span><span class="s2">&quot;np.ndarray&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Logic for computing the partial dependence of one feature for the base</span>
<span class="sd">    implementation (undistributed models)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lower_quantiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">upper_quantiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">grid</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="n">model_preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_fn</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">model_preds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_quantiles</span><span class="p">:</span>
            <span class="n">lower_quantiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">model_preds</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">upper_quantiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">model_preds</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_quantiles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">preds</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lower_quantiles</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">upper_quantiles</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.__partial_dep_pyspark" class="doc doc-heading">
            <code class=" language-python"><span class="n">__partial_dep_pyspark</span><span class="p">(</span><span class="n">feat_name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">is_categorical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Helper method for the PySpark implementation (distributed models).
Computes the partial dependences of one feature given its type (categorical or not)</p>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/partial_dependence.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__partial_dep_pyspark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">feat_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;pandas.DataFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;pyspark.sql.DataFrame&quot;</span><span class="p">],</span>  <span class="c1"># noqa: F821</span>
        <span class="n">grid</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="s2">&quot;np.array&quot;</span><span class="p">],</span>
        <span class="n">is_categorical</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span><span class="s2">&quot;np.ndarray&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Helper method for the PySpark implementation (distributed models).</span>
<span class="sd">    Computes the partial dependences of one feature given its type (categorical or not)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.ml.stat</span><span class="w"> </span><span class="kn">import</span> <span class="n">Summarizer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">col</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">sqlf</span>

    <span class="n">mean_preds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lower_quantiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">upper_quantiles</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">grid</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">temp_df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">feat_name</span><span class="p">,</span> <span class="n">sqlf</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">feat_name</span><span class="p">,</span> <span class="n">sqlf</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
        <span class="n">temp_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_fn</span><span class="p">(</span><span class="n">temp_df</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">output_col</span><span class="p">]</span><span class="o">.</span><span class="n">simpleString</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;vector&#39;</span><span class="p">:</span>
            <span class="c1"># Aggregate all the probability distributions</span>
            <span class="n">mean_preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_df</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">Summarizer</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_col</span><span class="p">)))</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_quantiles</span><span class="p">:</span>
                <span class="c1"># Tricky to calculate quantiles as Spark doesnt support this for Vector</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">_to_cols</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;probability&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

                <span class="n">pred_cols</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_to_cols</span><span class="p">)</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span>
                <span class="n">quants</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="n">pred_cols</span><span class="o">.</span><span class="n">approxQuantile</span><span class="p">(</span><span class="n">pred_cols</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_quantiles</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">lower_quantiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quants</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">upper_quantiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quants</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Aggregate all the prediction probabilities/targets</span>
            <span class="n">mean_preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_df</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">output_col</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_quantiles</span><span class="p">:</span>
                <span class="n">quants</span> <span class="o">=</span><span class="n">temp_df</span><span class="o">.</span><span class="n">approxQuantile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_quantiles</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>
                <span class="n">lower_quantiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quants</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">upper_quantiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quants</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_preds</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lower_quantiles</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">upper_quantiles</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.__pyspark_impl" class="doc doc-heading">
            <code class=" language-python"><span class="n">__pyspark_impl</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">feat_names</span><span class="p">,</span> <span class="n">categoricals</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Contains the logic for the pyspark implementation, i.e. the  one
which uses pyspark.DataFrames and undistributed models.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><span title="pyspark.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pyspark.DataFrame with ONLY the predictors.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feat_names</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[str]
List containing the names of the features that will be explained</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>categoricals</code>
            </td>
            <td>
                  <code>set</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>set[str]
Set with the feature names that will be forced to be categorical.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with the partial dependences of each selected feature</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>and whether that feature is categorical or not.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/partial_dependence.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__pyspark_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="s2">&quot;pyspark.DataFrame&quot;</span><span class="p">,</span> <span class="n">feat_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">categoricals</span><span class="p">:</span> <span class="nb">set</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>  <span class="c1"># noqa: F821</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Contains the logic for the pyspark implementation, i.e. the  one</span>
<span class="sd">    which uses pyspark.DataFrames and undistributed models.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: pyspark.DataFrame with ONLY the predictors.</span>
<span class="sd">        feat_names: list[str]</span>
<span class="sd">            List containing the names of the features that will be explained</span>
<span class="sd">        categoricals: set[str]</span>
<span class="sd">            Set with the feature names that will be forced to be categorical.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with the partial dependences of each selected feature</span>
<span class="sd">        and whether that feature is categorical or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">col</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">sqlf</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.types</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">FloatType</span><span class="p">,</span>
        <span class="n">DoubleType</span><span class="p">,</span>
        <span class="n">DecimalType</span><span class="p">,</span>
        <span class="n">LongType</span><span class="p">,</span>
        <span class="n">IntegerType</span><span class="p">,</span>
        <span class="n">ShortType</span><span class="p">,</span>
        <span class="n">ByteType</span>
    <span class="p">)</span>

    <span class="c1"># Pyspark names of float and integer datatypes</span>
    <span class="n">float_pyspark_types</span> <span class="o">=</span> <span class="p">(</span><span class="n">FloatType</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">,</span> <span class="n">DecimalType</span><span class="p">)</span>
    <span class="n">int_pyspark_types</span> <span class="o">=</span> <span class="p">(</span><span class="n">FloatType</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">,</span> <span class="n">LongType</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">ShortType</span><span class="p">,</span> <span class="n">ByteType</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Calculate unique values for disjoint set of columns from categoricals</span>
    <span class="n">cols_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">feat_names</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">categoricals</span><span class="p">]</span>
    <span class="c1"># Calculate all statistics at once to save collects</span>
    <span class="n">num_distinct_values</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
        <span class="o">*</span><span class="p">(</span><span class="n">sqlf</span><span class="o">.</span><span class="n">countDistinct</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols_to_check</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">minimums</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">sqlf</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">maximums</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">sqlf</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">feat_names</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">data</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Determine whether this column is discrete, real or categorical</span>
        <span class="n">is_categorical</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">dataType</span><span class="p">,</span> <span class="n">float_pyspark_types</span><span class="p">)</span> <span class="ow">and</span> <span class="n">colname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">categoricals</span><span class="p">:</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minimums</span><span class="p">[</span><span class="n">colname</span><span class="p">],</span> <span class="n">maximums</span><span class="p">[</span><span class="n">colname</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">dataType</span><span class="p">,</span> <span class="n">int_pyspark_types</span><span class="p">)</span> \
                <span class="ow">and</span> <span class="n">num_distinct_values</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_categorical_values</span><span class="p">:</span>
            <span class="n">step_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">maximums</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span> <span class="o">-</span> <span class="n">minimums</span><span class="p">[</span><span class="n">colname</span><span class="p">])</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">minimums</span><span class="p">[</span><span class="n">colname</span><span class="p">],</span> <span class="n">maximums</span><span class="p">[</span><span class="n">colname</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="n">step_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">colname</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
            <span class="n">is_categorical</span><span class="o">=</span><span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">type_msg</span> <span class="o">=</span> <span class="s1">&#39;categorical&#39;</span> <span class="k">if</span> <span class="n">is_categorical</span> <span class="k">else</span> <span class="s1">&#39;continuous&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting calculation for feature </span><span class="si">{</span><span class="n">colname</span><span class="si">}</span><span class="s2"> - Type: </span><span class="si">{</span><span class="n">type_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_categorical</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Values to test: </span><span class="si">{</span><span class="n">grid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Value range to test: [</span><span class="si">{</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">] (only on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="si">}</span><span class="s2"> items)&quot;</span><span class="p">)</span>

        <span class="n">data</span><span class="p">[</span><span class="n">colname</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span>
        <span class="n">pdep_means</span><span class="p">,</span> <span class="n">pdep_lquant</span><span class="p">,</span> <span class="n">pdep_uquant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__partial_dep_pyspark</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">is_categorical</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="n">colname</span><span class="p">][</span><span class="s1">&#39;preds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdep_means</span>
        <span class="n">data</span><span class="p">[</span><span class="n">colname</span><span class="p">][</span><span class="s1">&#39;lower_quantile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdep_lquant</span>
        <span class="n">data</span><span class="p">[</span><span class="n">colname</span><span class="p">][</span><span class="s1">&#39;upper_quantile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdep_uquant</span>
        <span class="n">data</span><span class="p">[</span><span class="n">colname</span><span class="p">][</span><span class="s1">&#39;categorical&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_categorical</span>

        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Partial dependence for feature </span><span class="si">{</span><span class="n">colname</span><span class="si">}</span><span class="s2"> calculated. Took </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.partial_dependence.PartialDependenceExplainer.explain" class="doc doc-heading">
            <code class=" language-python"><span class="n">explain</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">ignore_feats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">categoricals</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>This method will compute the partial dependences for a ML model.
This explainer also contains a distributed (pyspark) implementation which
allows PySpark transformers/pipelines to be explained via PD.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span> or <span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with only the features needed by the model.
This dataframe should ONLY contain the features consumed by the model and,
in the PySpark case, the vector-assembled column should be generated inside
of the predict_fn.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ignore_feats</code>
            </td>
            <td>
                  <code>List</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feature names which won't be explained</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>categoricals</code>
            </td>
            <td>
                  <code>List</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>of feature names that will be forced to be taken as
categoricals. If it's empty, the explainer will guess what columns are
categorical</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="mercury.explainability.explanations.partial_dependence.PartialDependenceExplanation" href="../explanations/#mercury.explainability.explanations.partial_dependence.PartialDependenceExplanation">PartialDependenceExplanation</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PartialDependenceExplanation containing the explanation results.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/partial_dependence.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;pandas.DataFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;pyspark.sql.DataFrame&quot;</span><span class="p">],</span>  <span class="c1"># noqa: F821</span>
        <span class="n">ignore_feats</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">categoricals</span><span class="p">:</span> <span class="n">TP</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">PartialDependenceExplanation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method will compute the partial dependences for a ML model.</span>
<span class="sd">    This explainer also contains a distributed (pyspark) implementation which</span>
<span class="sd">    allows PySpark transformers/pipelines to be explained via PD.</span>

<span class="sd">    Args:</span>
<span class="sd">        features (pandas.DataFrame or pyspark.sql.DataFrame):</span>
<span class="sd">            DataFrame with only the features needed by the model.</span>
<span class="sd">            This dataframe should ONLY contain the features consumed by the model and,</span>
<span class="sd">            in the PySpark case, the vector-assembled column should be generated inside</span>
<span class="sd">            of the predict_fn.</span>
<span class="sd">        ignore_feats (List):</span>
<span class="sd">            Feature names which won&#39;t be explained</span>
<span class="sd">        categoricals (List):</span>
<span class="sd">            of feature names that will be forced to be taken as</span>
<span class="sd">            categoricals. If it&#39;s empty, the explainer will guess what columns are</span>
<span class="sd">            categorical</span>

<span class="sd">    Returns:</span>
<span class="sd">        PartialDependenceExplanation containing the explanation results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ignore_feats</span> <span class="o">=</span> <span class="n">ignore_feats</span> <span class="k">if</span> <span class="n">ignore_feats</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="n">categoricals</span> <span class="o">=</span> <span class="n">categoricals</span> <span class="k">if</span> <span class="n">categoricals</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="n">partial_dep_impl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__base_impl</span>
    <span class="n">categoricals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">categoricals</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">!=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">partial_dep_impl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pyspark_impl</span>

    <span class="n">feat_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">ignore_feats</span><span class="p">)]</span>

    <span class="n">dependences</span> <span class="o">=</span> <span class="n">partial_dep_impl</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">feat_names</span><span class="p">,</span> <span class="n">categoricals</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PartialDependenceExplanation</span><span class="p">(</span><span class="n">dependences</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.explainability.explainers.shuffle_importance" class="doc doc-heading">
            <code>shuffle_importance</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.explainability.explainers.shuffle_importance.ShuffleImportanceExplainer" class="doc doc-heading">
              <code class=" language-python"><span class="n">ShuffleImportanceExplainer</span><span class="p">(</span><span class="n">eval_fn</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="mercury.explainability.explainers.explainer.MercuryExplainer" href="#mercury.explainability.explainers.explainer.MercuryExplainer">MercuryExplainer</a></code></p>


        <p>This explainer estimates the feature importance of each predictor for a
given black-box model. The used strategy consists on random shuffling one
variable at a time and, on each step, checking how much a particular
metric worses. The features which make the model to perform the worst are
the most important ones.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>eval_fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom evaluation function. It will recieve a DataFrame with features and
a Numpy array with the target outputs for each instance. It must
implement an inference process and return a metric to score the model
performance on the given data. This metric must be real numbered.
If we use a metric which higher values means better metric (like accuracy)
and we use the parameter <code>normalize=True</code> (default option), then it is
recommended to return the negative of that metric in <code>eval_fn</code> to make
the results more intuitive.
In the case of Pyspark explanations, the function will only recieve
a PySpark in the first argument already containing the target column,
whereas the second argument will be None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>normalize</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to scale the feature importances between 0 and 1. If True, then
it shows the relative importance of the features.
If False, then the feature importances will be the value of the metric
returned in <code>eval_fn</code> when shuffling the features.
Default value is True</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="c1"># &quot;Plain python&quot; example</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">PATH_DATA</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>  <span class="c1"># Targets</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">FEATURE_NAMES</span><span class="p">]</span> <span class="c1"># DataFrame with only features</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span><span class="w"> </span><span class="nf">my_inference_function</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explainer</span> <span class="o">=</span> <span class="n">ShuffleImportanceExplainer</span><span class="p">(</span><span class="n">my_inference_function</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explanation</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explanation</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="c1"># Explain a pyspark model (or pipeline)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">features</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">pandas_dataframe</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">target_colname</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span>  <span class="c1"># Column name with the ground truth labels</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span><span class="w"> </span><span class="nf">my_inference_function</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">model_inp</span> <span class="o">=</span> <span class="n">vectorAssembler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">model_out</span> <span class="o">=</span> <span class="n">my_pyspark_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">model_inp</span><span class="p">)</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">my_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">model_out</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explainer</span> <span class="o">=</span> <span class="n">ShuffleImportanceExplainer</span><span class="p">(</span><span class="n">my_inference_function</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explanation</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">target_colname</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">explanation</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>
</details>





                  <details class="quote">
                    <summary>Source code in <code>mercury/explainability/explainers/shuffle_importance.py</code></summary>
                    <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">eval_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;pd.DataFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;pyspark.sql.DataFrame&quot;</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;np.ndarray&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="nb">float</span><span class="p">],</span>  <span class="c1"># noqa: F821</span>
             <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval_fn</span> <span class="o">=</span> <span class="n">eval_fn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span> <span class="o">=</span> <span class="n">normalize</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="mercury.explainability.explainers.shuffle_importance.ShuffleImportanceExplainer.explain" class="doc doc-heading">
            <code class=" language-python"><span class="n">explain</span><span class="p">(</span><span class="n">predictors</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Explains the model given the data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>predictors</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="pyspark.sql.DataFrame">DataFrame</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with the features the model needs and that will be explained.
In the case of PySpark, this dataframe must  also contain a column
with the target.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ground-truth target for each one of the instances. In the case of
Pyspark, this should be the name of the column in the DataFrame which
holds the target.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if type(predictors) == pyspark.sql.DataFrame &amp;&amp; type(target) != str</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if type(predictors) == pyspark.sql.DataFrame &amp;&amp; target not in predictors.columns</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="mercury.explainability.explanations.shuffle_importance.FeatureImportanceExplanation" href="../explanations/#mercury.explainability.explanations.shuffle_importance.FeatureImportanceExplanation">FeatureImportanceExplanation</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>FeatureImportanceExplanation with the performances of the model</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>mercury/explainability/explainers/shuffle_importance.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">predictors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;pd.DataFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;pyspark.sql.DataFrame&quot;</span><span class="p">],</span>  <span class="c1"># noqa: F821</span>
            <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;np.ndarray&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FeatureImportanceExplanation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Explains the model given the data.</span>

<span class="sd">    Args:</span>
<span class="sd">        predictors (Union[pandas.DataFrame, pyspark.sql.DataFrame]):</span>
<span class="sd">            DataFrame with the features the model needs and that will be explained.</span>
<span class="sd">            In the case of PySpark, this dataframe must  also contain a column</span>
<span class="sd">            with the target.</span>
<span class="sd">        target (Union[numpy.ndarray, str]):</span>
<span class="sd">            The ground-truth target for each one of the instances. In the case of</span>
<span class="sd">            Pyspark, this should be the name of the column in the DataFrame which</span>
<span class="sd">            holds the target.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if type(predictors) == pyspark.sql.DataFrame &amp;&amp; type(target) != str</span>
<span class="sd">        ValueError: if type(predictors) == pyspark.sql.DataFrame &amp;&amp; target not in predictors.columns</span>

<span class="sd">    Returns:</span>
<span class="sd">        FeatureImportanceExplanation with the performances of the model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">implementation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__impl_base</span>
    <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Cheap way of check if type(predictors) == pyspark.sql.DataFrame (without importing pyspark).</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">predictors</span><span class="p">),</span> <span class="s1">&#39;toPandas&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;If predictors is a Spark DataFrame, target should be the name </span><span class="se">\</span>
<span class="s2">                             of the tareget column (a str)&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">implementation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__impl_pyspark</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">!=</span><span class="n">target</span><span class="p">,</span> <span class="n">predictors</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;`target` must be the name of the target column in the DataFrame. </span><span class="se">\</span>
<span class="s2">                             Value passed: </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictors</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">!=</span><span class="n">target</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">))</span>

    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">feature_names</span><span class="p">:</span>
        <span class="n">metrics</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">implementation</span><span class="p">(</span><span class="n">predictors</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">:</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_importances</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">FeatureImportanceExplanation</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["tabs", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f13b1293.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>